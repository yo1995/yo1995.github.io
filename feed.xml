<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Chen's Blog</title>
    <description></description>
    <link>https://yo1995.github.io/</link>
    <atom:link href="https://yo1995.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 09 Jul 2019 17:06:10 -0400</pubDate>
    <lastBuildDate>Tue, 09 Jul 2019 17:06:10 -0400</lastBuildDate>
    <generator>Jekyll v3.7.2</generator>
    
      <item>
        <title>GIF 与 QRcode 玩具二则</title>
        <description>&lt;h1 id=&quot;seo&quot;&gt;SEO&lt;/h1&gt;

&lt;p&gt;文件转GIF&lt;br /&gt;
文件转动图 分享&lt;br /&gt;
个性化二维码&lt;br /&gt;
彩色二维码&lt;br /&gt;
动图二维码&lt;br /&gt;
动态二维码&lt;br /&gt;
Animated QRcode
File to GIF&lt;/p&gt;

&lt;p&gt;搞一堆关键词蜜罐看有没有和我一样无聊的人掉进来……&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/yo1995/QRcode_Playground&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;引子&quot;&gt;引子&lt;/h2&gt;

&lt;p&gt;七月九号上午在看虎扑和 V2EX 的时候，突然想到了一个点子：是否可以把文件转化为 GIF 然后放在互联网的图床上进行分享呢？&lt;/p&gt;

&lt;p&gt;当今互联网时代，GIF 的历史使命尚未完成。由于其悠久的历史，几乎所有终端、设备、服务都会想方设法对齐进行兼容。就连最赶时髦的苹果，也不得不顺从民意，在 iOS 11 加入了相册对 GIF 动图预览的支持。可以预见，在下一个一统江湖的多媒体格式到来前，GIF 仍将在互联网的舞台中留存多日。&lt;/p&gt;

&lt;p&gt;GIF 的一大好处——各大图床为了保持最佳兼容性，一般对较小的 GIF 文件不会压缩。一些技术上较为保守的网站，如虎扑，甚至对任何 GIF 都不做处理直接存储。这便给了一些“巨大GIF”党可乘之机——在虎扑上，有个叫 iameasy81 的用户疯狂上传 400*400@50fps 的巨型 GIF 文件，动辄二三十兆，每次加载时都让我怀疑人生，还以为中美光缆阻塞了。&lt;/p&gt;

&lt;p&gt;当然，大多数平台不太愿意处理 GIF 文件，而是选择直接存储的原因，在于 GIF 优化是一个复杂且耗费算力的问题。由于 GIF89a 标准最初设计上较为简单，并没有类似 AVC 这样可以轻松指定画面质量、文件大小的特性，因而想将一张 GIF 压缩到指定尺寸，实际上是一个类似于猜+试的过程。同时，因为 GIF 标准存在许多变数，如局部色板、抖动、色板继承、颜色丢弃、透明色映射等等问题，倘若压缩程序写得不好，很有可能反而把一张精心优化过的 GIF 越压越大。因此，许多图床和文件存储选择睁一只眼闭一只眼，直接不修改存储 GIF，而这便是令我我产生这个想法的一大原因。&lt;/p&gt;

&lt;p&gt;事不宜迟，本想先把手头的活干完再来做这件事，但越想越觉得有意思且很容易实现，便立即开始写码。&lt;/p&gt;

&lt;h2 id=&quot;二维码&quot;&gt;二维码&lt;/h2&gt;

&lt;p&gt;二维码是日本人在九十年代发明的，最初为了提高工业工程的效率，后来演变为我们在电子支付、内容分享中日常用到的样子。二维码的本质就是讲字符串转为一张图像，然后接收端再通过模式识别解码图像，得到原来的字符串。二维码最初设计时便有了许多复杂的设计，如版本号，对应二维码的矩阵大小，从 21 * 21 到 177 * 177；定位图样，方便模式识别时确定旋转和对齐方向；纠错等级，分别有低中高最高。而且，最好的是——二维码的编码是定长码，这样等长字符串编码生成的二维码版本一定相同。为了找到一个合适的矩阵尺寸，我先用一些在线二维码生成器进行了简单的试验。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/201907/128-0.jpg&quot; alt=&quot;128个零&quot; /&gt;&lt;/p&gt;

&lt;p&gt;当我用全零字符串填充二维码时，如上图一样奇特的现象出现了——二维码的右半部分出现了规则的明暗相间的方块，好像一个棋盘。这是容易解释的，因为 0 对应的编码较为特殊，重复的相同字符造成了重复的图案。&lt;/p&gt;

&lt;p&gt;看到这个二维码，我突然想到之前见过的许多异形二维码，如三维棱台、圆角、艺术化等变化。上 GitHub 一搜，果然让我找到很多现成的库。其中，以 Halftone QRCodes 和 QArt 二维码最为抓人眼球。前者能够生成抖动的黑白 GIF二维码，且每一帧都能扫出相同的内容；后者能够将彩色图片作为背景嵌入二维码，也能支持动态图。事不宜迟，我便先开始尝试做动态二维码。&lt;/p&gt;

&lt;h2 id=&quot;个性二维码生成&quot;&gt;个性二维码生成&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/201907/worship.gif&quot; alt=&quot;膜&quot; /&gt; + 孙辰表示不服 = &lt;img src=&quot;/images/201907/bufu.gif&quot; alt=&quot;孙辰表示不服&quot; /&gt;&lt;/p&gt;

&lt;p&gt;重构了 CuteR 这个对 qrcode 进行封装的 Python 库。改进了坐标变换与并行执行的能力。通过给定输入字符串与输入的背景 GIF，即可得到输出的动态二维码。输出后再通过 gifsicle 进行优化压缩，得到最终的图像。示例参照上面的图像。&lt;/p&gt;

&lt;h2 id=&quot;文件转二维码-gif&quot;&gt;文件转二维码 GIF&lt;/h2&gt;

&lt;h3 id=&quot;逻辑&quot;&gt;逻辑&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;编码&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;首先将文件转为对应的 base64 字符串表示，然后将字符串按照 150 字符左右的长度分割，并将每个分割后的子串编码为二维码。接着把二维码转为 GIF 的一帧，并拼接得到输出 GIF。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;解码&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;将 GIF 文件按帧读取，对每一帧进行二维码解码，再将解码后得到的字符串进行拼接，并 base64 解码得到文件的二进制表达，存储到相应路径。&lt;/p&gt;

&lt;h3 id=&quot;改进&quot;&gt;改进&lt;/h3&gt;

&lt;p&gt;逻辑比较清晰和简单，改进主要存在于几方面。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;输出 GIF 的大小
由于 PIL 库默认的 GIF 支持很差，经过编码，13KB 的原文件竟然变成了 500KB 的 GIF。这样的倍率显然是不可以接受的。仔细一想，GIF 每一帧都是二维码，最简单的二维码应该只有黑白两种颜色，且其最小尺寸可以设置为二维码每一小方格为 1 像素时对应的尺寸。如此一来，我可以按照这个原则编码出每一帧都完全符合 GIF 规范时最小的数据帧。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;将 GIF 设为全局色板模式，且色板只有两个颜色。每一帧的间隔相等，取消单帧色板，并将 LZW 压缩中的码长也设为最小的 2bits。这样，生成的 GIF 文件称得上几近最小。当然，通过取消帧间丢弃的方法或许还能减小尺寸，但目测很有可能产生副作用——因为多加一种透明色相当于所有索引值都必须多 1bit，忽略头部中丢弃方法、延迟时间的字段，只有两帧间变化不到 50% 时才可能有提升。&lt;/p&gt;

&lt;p&gt;基于&lt;a href=&quot;https://github.com/yo1995/Ultimate-emoticon-generator&quot;&gt;之前项目&lt;/a&gt;中的 GIF 编码器，为这个 GIF 输出渲染重新定制了一个尽可能优化的版本。默认输出为二维码线宽 1px 的图像，在解码时再用最近邻方法放大为 2 倍以方便识别。&lt;/p&gt;

&lt;p&gt;测试结果：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;原文件&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;仅优化 GIF 渲染&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;未优化&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;111284(110KB)&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;387615(388KB)&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;2149022(2.2MB)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;线性改为并行
多帧图像处理是天生就适用于多线程的场景之一。如果不计帧间关系，每一帧都是独立的问题；就算考虑帧间关系，也只用同时处理两帧。将字符串通过 Python 的 multiprocessing 库异步生成二维码矩阵后渲染为图像，然后最后装配，能够大幅提升编码速度。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;测试结果：&lt;/p&gt;

&lt;p&gt;对于同一个 111KB 原文件的测试结果，共生成 1238 帧：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;并行&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;线性&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;10.25s&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;39.18s&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;每帧字符串长度与字符串码表
根据二维码的标准，大于等于 version 7 的二维码需要预留区域存放版本信息。因此，为了使输出 GIF 文件最小，应尽可能在每一帧中装入最多的字符。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;二维码的数字和英文字符码长不等，而 base64 编码后的字符串数字和字符的分配与二进制文件的字节有关，并不固定。测试中选择分割字符串长度在 125-134 之间能够编码到 version 6.根据参考资料中的数据来看，应该还能放更多，官网给出的数字+字母的数据是 195。而我实测只能放进 134 个字符。看了下 qrcode 库的源码，大概是其把所有数据都当成二进制字节进行处理以增强兼容性了。按照给的数据计算，如果是 base64 的数字+英文字符放进 195 个，而字节放进 134 个的话，相对能多放 45% 的字符；而二进制字节编码为 base64 后只增加 33%，似乎是一个不错的 trade-off。&lt;/p&gt;

&lt;p&gt;base64 编码由于把每三个字节编组后转为四个字节，在编码过程中就会使数据增加 33% 左右。根据二维码的特点，存在三种可能：数字编码，如 base8 或 base10；数字-字母编码，如 base64；二进制编码。我估计后两种的编码效率更高些。&lt;/p&gt;

&lt;p&gt;目前，我把 base64 和 base32 的编码方式都实现了。相对而言 base32 的效率稍高。参见下表的效率对比。两种编码方式均为最优 GIF 渲染。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;原文件 111284(110KB)&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;base32&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;base64&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;version 6&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;311562(312KBKB)&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;377123(377KBKB)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;version 40&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;204870(205KB)&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;248118(248KB)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;可见，目前最优情况 version 40 与 base32 编码搭配时，文件大小相对于原文件为 1.84 倍。考虑到 base32 编码效率约为 1.6 倍（5 字节转化为 8 字节），二维码最低纠错 7% 以后，理论上可以得到的最小值已经是 1.712 倍。这样看来，整个方法的各部分表现已经较为优秀。&lt;del&gt;写了半天忍不住自夸&lt;/del&gt;&lt;/p&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/201907/ECE564.png&quot; alt=&quot;测试文件&quot; /&gt; -&amp;gt; &lt;img src=&quot;/images/201907/b32_v40_4295.gif&quot; alt=&quot;编码后GIF&quot; /&gt;&lt;/p&gt;

&lt;p&gt;总体而言，若想实现这种转换，且不考虑对于人所持设备的兼容性的话，使用最大的二维码版本与最低的纠错参数时，可以达到膨胀率最低。如果需要考虑中途由人来识别，如设计一个 app 录像得到所有帧，再在手机里转为文件的话，尽量取被录制的二维码较小的版本可以更好保证识别率。&lt;/p&gt;

&lt;p&gt;最开始想到这个想法的时候，并不确定其可行性有多少。因为平时一直觉得 GIF 本来就挺大了，再加上二维码的冗余以及定位孔占据的位置，最后的结果一定不理想。结果编写测试完毕后，发现还是有一定可用性的。例如对于网上最常见的 5MB 图床来讲，将近可以放下两张软盘所能存储的内容，还是很客观的——要知道，哪怕到现在，我自己写过的所有文本文件加起来也只是在兆的量级而已。&lt;/p&gt;

&lt;p&gt;这个项目到此就告一段落了。目前看起来没有什么太大的应用，因为自己不会 js，没法把这样的编码解码器部署到前端供别人使用。同时，这种工具得有一定的用户规模，一传十十传百才能发挥实力。然而，如果这个工具流行起来，估计许多图床就会改变策略，禁止纯二维码动图的上传了，毕竟这种功能是游走在用户协议边缘的灰色地带的。&lt;/p&gt;

&lt;p&gt;写了一天代码，查了一天文档，自认为整体做得还算满意。未来有空封装为二进制文件。&lt;/p&gt;

&lt;h2 id=&quot;参考&quot;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.qrcode.com/en/about/version.html&quot;&gt;官网&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://coolshell.cn/articles/10590.html&quot;&gt;二维码的生成细节和原理&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/kciter/qart.js&quot;&gt;qart.js&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://cgv.cs.nthu.edu.tw/Projects/Recreational_Graphics/Halftone_QRCodes/&quot;&gt;Halftone QRCodes&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/chinuno-usami/CuteR&quot;&gt;CuteR&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.zhihu.com/question/22088907&quot;&gt;为什么 GIF 格式迟迟没有被取代？&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://cloud.tencent.com/developer/article/1004763&quot;&gt;浓缩的才是精华：浅析 GIF 格式图片的存储和压缩&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://blog.qr4.nl/page/QR-Code-Data-Capacity.aspx&quot;&gt;QR Code Data Capacity&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2008/06/base64.html&quot;&gt;base64 标准&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://tech.codeyellow.nl/blog/qr-encoding/&quot;&gt;qrcode base45&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://docs.python.org/3/library/base64.html&quot;&gt;Python base64 base32&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Tue, 09 Jul 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/coding/file-to-GIF/</link>
        <guid isPermaLink="true">https://yo1995.github.io/coding/file-to-GIF/</guid>
        
        <category>gif</category>
        
        <category>codec</category>
        
        <category>coding</category>
        
        <category>python</category>
        
        <category>image</category>
        
        
        <category>Coding</category>
        
      </item>
    
      <item>
        <title>Kitura 配置小感</title>
        <description>&lt;p&gt;&lt;a href=&quot;/coding/kitura-deployment&quot;&gt;上回&lt;/a&gt;说到，环境基本配好，HTTP服务器使用NGINX，所有路由由Kitura自行调配。跑通官方示例项目后，就该正式做Ric的需求了。&lt;/p&gt;

&lt;p&gt;当初接触Server Side Swift也是因为Ric突发奇想，希望在内网服务器上搭一个纯Swift的后台服务，从而实现从客户端到后台一门语言通吃的效果。实际上，安卓开发通过Java很早就能做到跨平台通吃的效果，不过Java的历史包袱比较沉重，之前和彭大哥做项目时候就曾了解到这一点。Windows平台上，C#似乎也有这方面的野心，但多年来UWP程序不温不火，轻量级应用又有Electron-Vue这样的前端框架异军突起，很难找到一款能够在Windows上完成原型并方便地跨平台的MSVC系工具。&lt;br /&gt;
一般来说，做什么工作就得选什么工具，工具不好用会浪费不少时间。这次配置编写这台服务器的服务时就体会到了这一点。原谅我水平不济，所有后台服务都想和Django比一比，比完后总会得出结论——Django真是好用啊！无论是数据库模型，还是默认的HTTP服务器，还是Python强大三方库社区的加持，还是验证管理会话安全等中间件……都非常适合对配置服务器或后台服务一知半解的小白——无需懂得太多，只需关注服务逻辑，就能很快搭出原型。想要用Kitura实现许多在Django里面半天就能搞定的功能，可算得上大费周章。&lt;/p&gt;

&lt;h2 id=&quot;第一个服务---emoji-server&quot;&gt;第一个服务 - Emoji Server&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.
├── [1.6K]  Package.swift
├── [4.0K]  public
│   ├── [4.0K]  css
│   │   ├── [5.1K]  emoji.css
│   │   ├── [3.2K]  emoji.css.map
│   │   ├── [ 17K]  github-markdown.css
│   │   └── [1.6K]  index.css
│   ├── [4.0K]  img
│   │   ├── [  49]  blank.gif
│   │   ├── [722K]  emoji_spritesheet_0.png
│   │   ├── [531K]  emoji_spritesheet_1.png
│   │   ├── [956K]  emoji_spritesheet_2.png
│   │   ├── [402K]  emoji_spritesheet_3.png
│   │   ├── [531K]  emoji_spritesheet_4.png
│   │   ├── [3.2K]  IconsetSmiles_1x.png
│   │   ├── [6.8K]  IconsetSmiles.png
│   │   ├── [ 13K]  IconsetW_1x.png
│   │   ├── [ 26K]  IconsetW.png
│   │   └── [5.5K]  plusSign.jpg
│   └── [4.0K]  js
│       ├── [126K]  config.js
│       ├── [2.9K]  emoji-picker.coffee
│       ├── [3.8K]  emoji-picker.js
│       ├── [3.0K]  emoji-picker.js.map
│       ├── [ 24K]  jquery.emojiarea.js
│       └── [5.4K]  util.js
├── [8.0K]  README.md
├── [4.0K]  Sources
│   ├── [4.0K]  Application
│   │   ├── [2.9K]  Application.swift
│   │   ├── [1.9K]  InitializationError.swift
│   │   ├── [2.3K]  Metrics.swift
│   │   ├── [4.0K]  Models
│   │   │   ├── [5.4K]  JournalEntry.swift
│   │   │   ├── [3.1K]  Persistence.swift
│   │   │   └── [2.2K]  UserAuth.swift
│   │   └── [4.0K]  Routes
│   │       ├── [2.9K]  EntryRoutes.swift
│   │       ├── [2.0K]  HealthRoutes.swift
│   │       ├── [ 919]  MarkdownRoutes.swift
│   │       ├── [ 543]  NotFoundRoutes.swift
│   │       ├── [2.3K]  UserRoutes.swift
│   │       └── [4.9K]  WebClientRoutes.swift
│   └── [4.0K]  EmojiJournalServer
│       └── [1.9K]  main.swift
├── [4.0K]  Tests
│   ├── [4.0K]  ApplicationTests
│   │   └── [4.3K]  RouteTests.swift
│   └── [ 102]  LinuxMain.swift
└── [4.0K]  Views
    ├── [4.0K]  docs
    │   ├── [ 252]  404.md
    │   ├── [ 18K]  564.md
    │   ├── [ 632]  doc2.md
    │   └── [2.5K]  index.md
    └── [4.3K]  home.stencil
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;基于网上的教程，搭起了&lt;a href=&quot;https://github.com/yo1995/Daily_Swift_Tasks/tree/master/Kitura_EmojiServer&quot;&gt;第一个服务&lt;/a&gt;进行测试。再次赞美Kitura，其结构设计的比较合理，MVC各个模块分割清晰，静态文件服务也很方便配置。第一个服务搭起来没有太大的困难，在解决了一些依赖的版本冲突和PostgreSQL安装配置问题后，整个服务运行的很良好。&lt;/p&gt;

&lt;p&gt;Kitura自带的OpenAPI组件能够自动生成所有Codable Routes的API示例界面与测试功能。因此，所有基于RESTful的API全都能够在一个界面上看到和管理，非常方便，省去了用Postman一个个测试的麻烦。在此基础上，我又改进和新加了几个功能，从而完成了EmojiJournal使其真正能够使用。直到这时，我还觉得搭服务简直轻而易举，甚至一度认为Kitura跟Django的易用性差不多了。&lt;/p&gt;

&lt;p&gt;高兴的太早了。&lt;/p&gt;

&lt;h2 id=&quot;第二个服务--ece564-server&quot;&gt;第二个服务- ECE564 Server&lt;/h2&gt;

&lt;p&gt;给Ric简单介绍完，他觉得看起来不错，于是我便着手开始搭建ECE564的服务器。这个服务的内容其实也很简单——CRUD数据库操作封装成RESTful API，加以简单的展示和管理界面，再加上一个文件传输存储服务便大功告成。实际上，日常大多数API服务器的工作也就是这些，如果没有高并发分布式等需求，大可以把这次的服务器当做一个范本，以后再起服务器时就不用费尽周折再配置了。在这里不得不再次说，Django真的非常方便。上述功能Django的默认组件基本都已经囊括，无需用户再去调研该引入哪些依赖。&lt;/p&gt;

&lt;h3 id=&quot;api&quot;&gt;API&lt;/h3&gt;

&lt;p&gt;Kitura的API可分为两种：Codable Route、Raw Route。&lt;br /&gt;
Raw Route顾名思义就是原始数据相关的API，相当于中间件仅将请求封装成一个对象而已，很多parse、decode的工作需要自行完成。在处理文件上传时，由于请求一般为form-data或者binary，所以需要用到原始路由。&lt;br /&gt;
Codable Route高度整合了Swift 4引入的Codable protocol，也继承了JSON的简洁与易用的特点，将较为简单的请求和响应均封装为JSON字符串进行传输。像查找数据库相关的操作，由于不需要传输二进制文件，因此可以全部写成Codable路由。另外，借助Swift的Completion Handler的概念，写起异步阻塞来轻而易举。或许是我才疏学浅，反正从正经下决心学习编程以来，Swift的线程相关的操作是最直观、封装程度最好、可预期性最强的语言。在写C/C++的socket时经常弄乱，最后把整个请求搞成全线性阻塞的导致性能极差，还有select以后处理不好，真的很纠结；写Python和Django时虽说有了请求中间件的封装方便了许多，但上次为了保持文件和数据库同步时先存再取改完再存的窒息操作仍历历在目……甚至直到大四上学期，我还搞不懂线程和进程、多线程和超线程、同步和异步这一大套之间的联系。直到现在，写了很多Swift之后，我才稍稍有了点得心应手的感觉，不得不赞美Swift简明清晰的语法。&lt;/p&gt;

&lt;p&gt;写好API准备测试，遇到了前所未有的挑战——当我将人员条目的模型创建好数据库，POST完准备读取时，无论怎么尝试都是500.当时真是汗刷地一下就下来了。完全不合理啊，于是我左改又改，首先通过其他服务确定HTTP服务器没有问题，然后再看路由也没有走错，但始终无法解决问题。带着疑惑与不解，灰溜溜地十二点回家。&lt;/p&gt;

&lt;p&gt;第二天重整旗鼓，梳理思路，先从最小可运行的实例开始慢慢往上加东西。当我在模型加入5个成员时，没有问题；当我加到8个，便再次500……我还以为每一行数据大小有限制呢，研究了半天pq似乎真的有限制，但我实在不敢相信区区几个字符就能溢出。&lt;/p&gt;

&lt;p&gt;然后开始从8个减到6个，依旧500，再减到5个，瞬间恢复。其间不知道DROP TABLE多少次，直到我看到struct里成员的命名才发现端倪：全小写时就能工作，加入camelCase的命名就炸……赶忙谷歌一搜，果然——pq列名称只能小写！&lt;/p&gt;

&lt;p&gt;后来复盘时分析为什么花了将近6个小时才发现这个问题，原因大致有如下几个：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;第一次学pq时用的是C++，C++约定的变量名称是snake的，一般不包含大写字母，因此没有被这个问题困扰过；&lt;/li&gt;
  &lt;li&gt;之后用Django时Python也是snake的，而且用的是SQLite，便以为所有数据库在这方面应该没啥区别；&lt;/li&gt;
  &lt;li&gt;示例程序里非数据库的struct中有使用camelCase的变量名，而存进数据库的模型中变量个数又很少，导致我想当然认为没有区别；&lt;/li&gt;
  &lt;li&gt;认为ORM在模型映射的过程中应该会代为解决这些问题，用户毋需关心。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;总之，一个非常弱的小问题浪费了大量时间，令我很难过😢。&lt;/p&gt;

&lt;h3 id=&quot;前端&quot;&gt;前端&lt;/h3&gt;

&lt;p&gt;为了使数据库展示较为美观，也是受了Django自带管理界面的影响，我决定也部署一个类似的数据库管理前端界面。&lt;/p&gt;

&lt;p&gt;对于pq，官方推荐的自然是pqAdmin 4了。Mac上安装时自带就是这个工具，自然我也先尝试使用它。&lt;/p&gt;

&lt;p&gt;安装好以后，在MobaXterm上输入&lt;code class=&quot;highlighter-rouge&quot;&gt;pqadmin4&lt;/code&gt;后，过了一会居然直接弹出一个Ubuntu FireFox的图形界面来，让我相当差异。之前见过的类似情景无非gedit跳出个编辑器，这一下搞出个浏览器，让我重新认识了terminal的功能。但是实在不好用，而且在Mac上不知道为什么&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -X&lt;/code&gt;并不能实现类似的效果。&lt;br /&gt;
尝试将pqadmin设置成headless的，无果；以&lt;code class=&quot;highlighter-rouge&quot;&gt;pqadmin server mode&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;pqadmin remote&lt;/code&gt;查询了一大堆帖子，还是设置不好通过HTTP服务从外部访问。甚至还有一种说法在某个版本前，pdadmin必须代理在域名根目录下才能运行。价值pqadmin的界面实在不好用，遂弃之。&lt;/p&gt;

&lt;p&gt;pqadmin在我看来就是web1.0时代人们对互联网服务的理解——桌面应用的翻版，功能庞杂而缺少设计感，大量的文字和元素充斥着页面，想看一下数据库中某张表的数据需要点击十余次鼠标，或在键盘输入SQL命令才能实现。因此只得放弃这个方案。&lt;br /&gt;
接着在GitHub一搜，有个叫pqweb的项目星很多。部署了一下一测试，意外的好用！一个界面，一次登录，查看所有数据库中所有的表；不提供鼠标编辑，但可以执行SQL；表结构、约束关系、历史记录、连接状态一应俱全，非常紧凑。一下子就决定用它了。&lt;br /&gt;
唯一的问题是Windows端必须得开cmd输入正确参数才能连上数据库，没有默认的WebUI，稍显不足。&lt;/p&gt;

&lt;p&gt;为了不重复造轮子，就没有做前端的增加数据功能。毕竟这个服务器是给学生在客户端发请求用的，再搞个网页端的编辑功能有些画蛇添足。况且，我不太会搞前端的设计，尤其是js那一大套……&lt;/p&gt;

&lt;p&gt;做了个卡片式的条目展示，这时候RESTful API的优势就显现出来了——ajax发个REST请求，直接就返回JSON，在页面上更新，逻辑非常清晰。但是改CSS和js还是费了不少劲，由于对于前端不太了解，想实现任何功能都要去查如何调库，费了半天劲才写出二三十行代码的感觉很不爽。&lt;/p&gt;

&lt;h3 id=&quot;匿名请求&quot;&gt;匿名请求&lt;/h3&gt;

&lt;p&gt;最初我是想在访问数据库的过程中加入登录验证的。但后来一想初学者可能弄不清这些复杂的逻辑，遂重新写了匿名请求的API。同时，还怕他们搞不清PUT和POST的区别，于是把PUT的功能也揉进POST里面了。希望我多费点儿时间能让他们少点纠结吧。&lt;/p&gt;

&lt;p&gt;如何厘清匿名时哪些数据可写可改可删，哪些数据可查还是有点复杂。最后我设计的是&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;所有数据可通过id查询，通过netID进行过滤，或者直接查询所有数据；&lt;/li&gt;
  &lt;li&gt;所有匿名上传数据可通过id匿名删除和修改&lt;/li&gt;
  &lt;li&gt;可匿名增加数据，在数据库里上传者的字段设为一个统一的匿名用户，如果增加时id与已有条目重复则变为修改；如果违反netID的UNIQUE约束则禁止增加。&lt;/li&gt;
  &lt;li&gt;登录后的用户可以任意操作本账号对应的条目&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如此一来，登录和匿名的范围就基本分清了。&lt;/p&gt;

&lt;h3 id=&quot;头像图片文件上传&quot;&gt;头像图片文件上传&lt;/h3&gt;

&lt;p&gt;对于文件上传，最初我是有些纠结的。去年当我初学时，Ric的设计是一切基于JSON，所有都是字符。这样一来，上传文件就变成了先把文件数据转为base64，然后填到JSON字段里POST。虽说这样避免了表单操作，但却增添了后台的难度。究竟应该把这个base64存在数据库里，还是解码后存成文件？返回响应时是把二进制文件传回去，还是再转为base64传回去，还是直接返回一个链接？&lt;br /&gt;
把二进制文件存在数据库里的坏处就在于无端增大了每个条目的大小，且使条目占用空间不可控，必须的按照最大的文件分配。去年采用的就是这样的方案，每次从服务器GET的时候都要等三五秒，体验不太好，因此这次轮到我设计时想做一些改变。&lt;br /&gt;
一般而言，图片文件等二进制文件都该存在静态文件区，数据库中只存相对路径。请求时返回路径就行。这次我也是如此实现的。&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Avatar&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Model&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;netid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// size in bytes&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;md5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/avatar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;middleware&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;BodyParser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;multipartBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Part&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asMultiPart&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;noContent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;通过Kitura自带的中间件分析请求，解码为multipart/form-data类型，然后将其中字段读出。md5校验后将文件存储到静态文件目录，并计算文件大小，最终存入数据库。对于重复处理，我的标准是基于netID进行判断——如果不存在则为创建；如果存在则为更新。理论上来说，每次新增或者更新前应该先把之前的文件删掉，但为了图省事暂时直接覆盖。这样会引入一个问题，就是对于同一个netID如果用户上传与上次图片文件类型不同，数据库中现有文件将无法追踪，只能手动删除。不过因为应用规模很小，到时手动清理或许比先删再加处理错误更简单。&lt;/p&gt;

&lt;p&gt;经过测试，文件上传一切正常，整个项目也终于成了气候。下周一看看Ric怎么说吧。&lt;/p&gt;

&lt;h3 id=&quot;示例文件编写&quot;&gt;示例文件编写&lt;/h3&gt;

&lt;p&gt;为了做得稍微圆满一些，我给所有需要用到的API编写了示例代码，GET/POST/PUT/DELETE分别存在playground文件中。&lt;/p&gt;

&lt;p&gt;在写参考代码时才发现playground的window机制竟然也很hacky——是用一个iPad simulator精简后实现的。当代码崩溃时，能够看到一个iPad模拟器满桌面全是没有图标的应用😂。同时估计也是相同原因，playground的window还写死为768*1024的大小，导致许多和UI有关的测试都不太方便。Playground还是适合作为一个类似于Jupyter Notebook的工具来使用。&lt;/p&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;p&gt;这篇文章特地没有涉及许多技术细节，因为这次写的代码自我感觉非常良好，代码的“自明性”很高，直接看代码就能读懂逻辑，用不着记录太多细节。希望以后翻到这篇文章时不要被打脸🤣。&lt;/p&gt;

&lt;p&gt;总体来说，搭建一个常规的后台服务，在2019年已经不是什么难事。几乎任何流行的主流互联网语言都具备这种能力，而且造好的轮子很多，只需自己实现“胶合”代码、业务逻辑即可快速建立原型。这在Web1.0时代是难以想象的。跟彭哥讨论项目时，他讲过当初在IBM做JavaEE时配置环境、部署应用是一件非常重量级的任务。几十兆的jar包搭配着WSGI、xml、SOAP等初代互联网协议栈，以及缺乏趁手的版本管理工具、API管理工具等困难，诸多因素混合在一起导致传统应用十分臃肿而错综复杂。而如今，对于Kitura、对于Django，只需一杯茶的功夫，一个后台服务就能冉冉升起，真让我觉得赶上了学编程的好时机。&lt;/p&gt;

&lt;h3 id=&quot;20190628-tree&quot;&gt;20190628 Tree&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.
├── [9.2K]  Package.resolved
├── [1.6K]  Package.swift
├── [4.0K]  public
│   ├── [4.0K]  avatars
│   │   ├── [ 11K]  ece564.png
│   │   └── [ 67K]  tc233.png
│   ├── [4.0K]  css
│   │   ├── [5.1K]  emoji.css
│   │   ├── [ 17K]  github-markdown.css
│   │   └── [1.7K]  index.css
│   ├── [4.0K]  img
│   │   ├── [  49]  blank.gif
│   │   ├── [3.2K]  IconsetSmiles_1x.png
│   │   ├── [6.8K]  IconsetSmiles.png
│   │   ├── [ 13K]  IconsetW_1x.png
│   │   └── [ 26K]  IconsetW.png
│   └── [4.0K]  js
│       └── [5.4K]  util.js
├── [4.0K]  Sources
│   ├── [4.0K]  Application
│   │   ├── [1.2K]  Application.swift
│   │   ├── [ 247]  InitializationError.swift
│   │   ├── [ 717]  Metrics.swift
│   │   ├── [4.0K]  Models
│   │   │   ├── [ 265]  DukePersonAvatar.swift
│   │   │   ├── [9.7K]  DukePersonEntry.swift
│   │   │   ├── [2.3K]  Persistence.swift
│   │   │   └── [ 870]  UserAuth.swift
│   │   ├── [4.0K]  Routes
│   │   │   ├── [5.5K]  AnonymousRoutes.swift
│   │   │   ├── [ 11K]  AvatarRoutes.swift
│   │   │   ├── [1.7K]  EntryRoutes.swift
│   │   │   ├── [ 390]  HealthRoutes.swift
│   │   │   ├── [ 919]  MarkdownRoutes.swift
│   │   │   ├── [ 543]  NotFoundRoutes.swift
│   │   │   ├── [ 713]  UserRoutes.swift
│   │   │   └── [3.8K]  WebClientRoutes.swift
│   │   └── [1.6K]  Utils.swift
│   └── [4.0K]  ECE564Server
│       └── [ 227]  main.swift
├── [4.0K]  Tests
│   ├── [4.0K]  ApplicationTests
│   │   └── [4.3K]  RouteTests.swift
│   └── [ 102]  LinuxMain.swift
└── [4.0K]  Views
    ├── [4.0K]  docs
    │   ├── [ 367]  404.md
    │   └── [2.1K]  index.md
    └── [5.3K]  home.stencil

14 directories, 35 files
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;参考链接&quot;&gt;参考链接&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://gitlab.oit.duke.edu/tc233/ece564_2019fall_prep&quot;&gt;项目地址&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/IBM-Swift/Kitura/pull/1260&quot;&gt;Multipart Doc revision&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;// https://github.com/vapor/vapor/issues/730&quot;&gt;Write file to disk on Ubuntu&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;// https://stackoverflow.com/questions/26707352/how-to-split-filename-from-file-extension-in-swift&quot;&gt;File name extensions&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://ibm-swift.github.io/Kitura/Classes/BodyParser.html&quot;&gt;Kitura Raw BodyParser&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/IBM-Swift/Swift-Kuery-ORM/issues/89&quot;&gt;PQ field limitations&lt;/a&gt;
need to serialize array into string due to ORM limitations&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/28268145/get-file-size-in-swift&quot;&gt;Swift get file size&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/42935148/swift-calculate-md5-checksum-for-large-files&quot;&gt;Swift md5&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/IBM-Swift/BlueCryptor&quot;&gt;Swift CommonCryptos for Ubuntu - BlueCryptor&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://github.com/yo1995/Daily_Swift_Tasks/blob/master/Kitura_EmojiServer&quot;&gt;EmojiServer&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/47076329/swift-string-escaping-when-serializing-to-json-using-codable&quot;&gt;Replace backslash&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 27 Jun 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/coding/kitura-setup/</link>
        <guid isPermaLink="true">https://yo1995.github.io/coding/kitura-setup/</guid>
        
        <category>swift</category>
        
        <category>mac</category>
        
        <category>coding</category>
        
        
        <category>Coding</category>
        
      </item>
    
      <item>
        <title>Kitura deployment notes</title>
        <description>&lt;h2 id=&quot;背景&quot;&gt;背景&lt;/h2&gt;

&lt;p&gt;Ric前些阵子提出想部署一个纯Swift的开发环境，即macOS/iOS客户端用Swift写，后台服务器也用Swift起。这样的好处在于开发者只用掌握一门语言，即可完成“全栈”——整个应用的开发流程。&lt;/p&gt;

&lt;p&gt;事不宜迟，我马上去调研有哪些较为成熟的后端方案。首先映入眼帘的是&lt;a href=&quot;https://github.com/IBM-Swift/Kitura&quot;&gt;Kitura&lt;/a&gt;/&lt;a href=&quot;https://github.com/vapor/vapor&quot;&gt;Vapor&lt;/a&gt;/&lt;a href=&quot;https://github.com/PerfectlySoft/Perfect&quot;&gt;Perfect&lt;/a&gt;三驾马车。其中Kitura是IBM牵头的，其他二者为第三方为主导。更新频率方面，Vapor最快最勤，亲身践行了Swift官方跨大版本该API的“优良传统”，每次升级有很多部分推倒重来；Kitura有如IBM的一贯作风，稳健迟缓，据说后向兼容性能够保持到初代；Perfect虽说有一点中文支持，但更新频率赶不上二者，直到Swift5.1发布时依旧只停留在4.1的支持。&lt;/p&gt;

&lt;p&gt;最开始我是选择了Kitura的，无它，相信大品牌&lt;del&gt;名字读起来带感&lt;/del&gt;。它的文档也是比较全面而克制的，简洁而富有表达力，花了半小时就配好了环境。一切顺利，我想先试试官方提到的几个亮点功能吧，结果随便安装了个Markdown，发现渲染效果不堪直视——连表格和任务清单都无法渲染。这让我这个GitLab中度用户非常不爽，遂弃而转向Vapor。&lt;/p&gt;

&lt;p&gt;Vapor的安装稍微多花一点时间，原因是其初始的“内置电池”，自带功能比较多，在3409这台Core Duo E8400的老机器上编译花了不少时间。加上后端Swift暂时还通过一个叫做SPM的工具管理，原理类似Carthage，不如CocoaPods可以直接引入二进制文件那么快。在等的过程中，我便熟悉了一下Vapor的文档。&lt;/p&gt;

&lt;p&gt;作为一个只用过Python Web后端的菜鸟选手，我对服务器的认识主要来源于Django。Django的文档既清晰又极具操作性，每次忘记一些概念，开个项目一试就弄清了，非常适合学生做点自用的小服务器。上次Livid还说Django是“重量级”的服务，我倒不觉得。较之LAMP、Nginx，Django的部署可谓相当轻松了。&lt;/p&gt;

&lt;p&gt;不过在看文档的过程中，还是有些隐忧。相比于Kitura，Vapor的“跑路”可能性更大。项目的姊妹云服务标价没啥竞争力，整个网站也有点买模板的感觉，Ubuntu的文档不如Kitura详细。语法也没有其那么标准易于理解。无论如何，还是先部署一个试试。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;安装swift环境&quot;&gt;安装Swift环境&lt;/h2&gt;

&lt;p&gt;从&lt;a href=&quot;https://swift.org/download/&quot;&gt;官网&lt;/a&gt;下载，检查签名然后解压。如果不直接放进系统的bin的话，需要设置环境变量：&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/path/to/usr/bin:&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;执行或者将其加入&lt;code class=&quot;highlighter-rouge&quot;&gt;~/.bashrc&lt;/code&gt;即可。&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;swift &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;以检查环境是否正确，Swift程序可以找到。&lt;/p&gt;

&lt;h2 id=&quot;安装vapor环境&quot;&gt;安装Vapor环境&lt;/h2&gt;

&lt;p&gt;目前2019年6月19日最新版本的环境是Vapor4，但仅支持Swift5.1.由于Swift官网发布版还在5.0.1版，因此就退而求其次选了Vapor3。等秋季开始时再看是否需要升级。&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-sL&lt;/span&gt; https://apt.vapor.sh&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;vapor
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vapor &lt;span class=&quot;nt&quot;&gt;--help&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;检查vapor环境正确。&lt;/p&gt;

&lt;p&gt;然后通过&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vapor new &amp;lt;your-project-name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;创建一个APP。与Django的startproject过程一样，都会创建一个包含设置、路由以及MVC的项目。不同的是，Vapor把文件夹都默认好了，只要把对应模块放进去即可。&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vapor build
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vapor run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;或直接运行run也会增量编译。&lt;/p&gt;

&lt;p&gt;默认编译是Debug的scheme，可通过&lt;code class=&quot;highlighter-rouge&quot;&gt;vapor run--env production&lt;/code&gt;设为禁用debug输出等等。
最后编译运行，即可在&lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:8080&lt;/code&gt;看到It works的字样。&lt;/p&gt;

&lt;h2 id=&quot;配置nginx代理&quot;&gt;配置Nginx代理&lt;/h2&gt;

&lt;p&gt;本以为应该没啥问题，结果栽了大跟头。先说说桌子下这台Core Duo的主机。估计有年头了，CPU E8400，至少也是08或09年的机器了。内存2G、硬盘20G，由工院IT支持部门的小哥维护，通过netID登录，网卡注册到devices页面。这网络配置跟散落在学校各处的iMac估计很类似。然而最初我并未意识到这点，仍以为这是台空白的，完全由自己掌控的电脑。&lt;/p&gt;

&lt;p&gt;于是就一步步来呗，按照一个&lt;a href=&quot;https://medium.com/@ahmedraad/how-to-deploy-vapor-app-on-ubuntu-16-04-and-run-it-in-production-eef18f7b4f05&quot;&gt;教程&lt;/a&gt;安装了个Supervisor，后来觉得还是直接用screen留着会话，每次连上去看log比较简单，于是又改了回来。&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;supervisorctl status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;的效果与&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;screen &lt;span class=&quot;nt&quot;&gt;-ls&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;并不一样，一个是监控进程状态，另一个是监控会话状态。&lt;/p&gt;

&lt;p&gt;然后第二部分教程让改防火墙。这也很正常，毕竟Windows每次做些跟网络有关的实验也需要关。&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ufw &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ufw allow ssh
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ufw allow http
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ufw status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;此处ufw是&lt;code class=&quot;highlighter-rouge&quot;&gt;Uncomplicated Firewall&lt;/code&gt;的简称，是Ubuntu的简化版iptables，也就是这段网上看来的描述坑了我两三个小时的时间。&lt;/p&gt;

&lt;p&gt;把ufw打开，允许22和80端口，这都很容易理解。然后配置nginx，因为暂时没有域名，所以直接搞&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nano /etc/nginx/sites-available/default
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;即可，指定80端口（上面防火墙允许了的），然后映射到本地的8080端口。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server {
    listen 80 default_server;
    listen [::]:80 default_server;
    location / {
        proxy_pass http://127.0.0.1:8080;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;一切都是简单直观，不应该有任何问题。然而一刷新我傻了：&lt;code class=&quot;highlighter-rouge&quot;&gt;Connection Refused.&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;不死心，换了两台设备测，结果一台是timeout另一台也是refused。这让我顿生疑虑。一般而言我见过的refused都因为服务器配置了规则禁止连接，但怎么又会timeout呢？难道是nginx根本没起来？&lt;/p&gt;

&lt;p&gt;花了半小时了解如何获取nginx运行状态，以及&lt;a href=&quot;https://www.keycdn.com/support/nginx-commands&quot;&gt;常见nginx操作&lt;/a&gt;：&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;service nginx status
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl status nginx.service
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;lsof &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; TCP:80
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl &lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt; is-active nginx &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;It is active&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;systemctl restart nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;检查了一圈发现，似乎问题不在它身上。当时还在用Supervisor，又花了半小时研究如何检查它的状态，发现除了写了个typo以外并没有什么问题。题外话：自己打字不好速度快容易错的毛病，在开始学编程后被急剧放大，经常因为打错字怀疑人生，打错字挥泪重启服务器的举动不知一次出现——循环条件错死循环、内核变量地址错kernel panic，如此种种，累觉不爱。吭哧吭哧又浪费半小时，排除了它的嫌疑。&lt;/p&gt;

&lt;p&gt;冷静下来一想，本地既然能够访问，那说明跟Swift和Vapor都没有关系。但是localhost能够访问127.0.0.1却不能，这又是为什么呢？感觉自己逐渐抓住了重点，于是去看hosts，看ufw的设置，C(4,2)一番穷举测试发现并没有什么用。时间不知不觉地流逝，只好一边吃差强人意的速冻盒饭一边调试。怎么设置ufw都没用，真的有些气馁了。还能有啥原因呢？&lt;/p&gt;

&lt;p&gt;最后只能硬着头皮用关键字搜，搜到了关于&lt;a href=&quot;https://serverfault.com/questions/129086/how-to-start-stop-iptables-on-ubuntu&quot;&gt;iptables&lt;/a&gt;的操作。先是看到了个&lt;a href=&quot;https://serverfault.com/questions/670575/failed-to-connect-to-127-0-0-1-port-80&quot;&gt;类似的问题&lt;/a&gt;，然后开始现场学&lt;a href=&quot;https://www.howtogeek.com/177621/the-beginners-guide-to-iptables-the-linux-firewall/&quot;&gt;如何改iptables&lt;/a&gt;。最后打开这台主机的iptables一看，唉呀妈呀这是turd mountain啊！&lt;/p&gt;

&lt;p&gt;130多行的规则，清晰地划分了学院各个子网的访问权限，其中INPUT部分的&lt;code class=&quot;highlighter-rouge&quot;&gt;-A INPUT -j drop&lt;/code&gt;赫然在目。就是这句话浪费了我人生中宝贵的两个半小时。之前一直以为这是台人畜无害的干净主机，甚至连git和nginx都没装过。谁曾想，没装过nginx却把防火墙规则配了一溜够，真是披着羊皮的狼！&lt;/p&gt;

&lt;p&gt;试了试发现靠前的条目优先级高于靠后的条目，于是加了一句&lt;code class=&quot;highlighter-rouge&quot;&gt;-A INPUT -s 10.0.0.0/8 -p tcp -m tcp --dport 80 -j ACCEPT&lt;/code&gt;
解决问题。按理说，我是不应该配置这台主机的网络的，但阴差阳错又折腾得够呛。除了新知道一个词iptables以外，大半天时间全无收获，非常烦躁。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;后记&quot;&gt;后记&lt;/h2&gt;

&lt;p&gt;越多地经历这样的情景，越让我觉得刷题有些可取之处。至少刷题时大脑能一直保持活动，时间不算浪费。而这种环境问题自己去找答案除了浪费时间毫无意义。最开始本想找个docker直接配好，结果这种小众的东西并没有人做高度定制化的docker，只有官方的两个镜像孤零零地挂在hub上。&lt;/p&gt;

&lt;p&gt;又想到可能会要用CUDA，干脆别折腾了，花点钱买AWS算了。&lt;/p&gt;

&lt;p&gt;吐槽完了，接着说Vapor，看它文档的功能还挺多挺全，而且Swift的Foundation并不比Python自带的库弱。尤其是宣传的性能Swift甚至能追上Go，令人很心动。之前看了几行go的代码，真的是难受啊，比C还难看。&lt;/p&gt;

&lt;p&gt;自己没想过成为一个程序员大牛，只希望能用计算机语言在最短的时间创造最大的快捷、便利、快乐与幸福，这便是我在计算机领域的理想。Swift、Python、MATLAB、Verilog加之MSVC家族，自下而上，由内到外，基本已经能满足我能想到的大部分设想。或许没必要再纠结于编译原理，本身就是门外汉，何必与专业人士比拼他们的强项呢？&lt;/p&gt;

&lt;p&gt;看着时长横跨17-19年的人生“或许是第一篇也是最后一篇”论文，从科研的急先锋跌至吊车尾，从编程的门外汉闯进疯人院……今天在和Millie录像时突然回首这两年，变化实在不小。或许在法国的平行世界中，我的变化更大？驾驶帆船乘风破浪在芒什海峡？摇车登上阿尔普迪埃？……&lt;/p&gt;

&lt;p&gt;兜兜转转多年后，还是踏进了编程的世界，不知压箱底的辛文送的Java教材会作何感想。&lt;/p&gt;

&lt;p&gt;满纸荒唐言，一把辛酸泪。😢&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;190623-补充&quot;&gt;190623 补充&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;关于 WebSocket 的设置&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;环境搭好了以后主要通过两个项目来入门学习后端的配置与编写服务。一个是&lt;a href=&quot;https://github.com/IBM-Swift/Kitura-Sample&quot;&gt;Kitura-Sample&lt;/a&gt;，也就是Kitura官方教程汇总的一个repo。其中有一些问题已经通过issue反馈给了项目管理员。不得不说，正规军的响应速度、解答的耐心程度都值得称道，让我对IBM这家公司路转粉。&lt;/p&gt;

&lt;p&gt;在当前的项目中，有一个基于 WebSocket 的在线聊天室的实现。后端代码虽然简单但不失为一个好的脚手架，况且Swift原生的类似程序很少，值得继续探究。但当我想登入聊天室测试一下时，奇怪的事情发生了：&lt;code class=&quot;highlighter-rouge&quot;&gt;WebSocket connection failed: Error during WebSocket handshake: Unexpected response code: 302&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;按理说302并非一个错误代码，可为什么无法建立连接呢？分别试了防火墙端口、路由路径以及npm依赖重装以后仍旧没有解决。在&lt;a href=&quot;https://stackoverflow.com/questions/41381444/websocket-connection-failed-error-during-websocket-handshake-unexpected-respon&quot;&gt;SO的帖子&lt;/a&gt;上却看到了真正的原因。似乎是因为 Nginx 需要对 WebSocket 的 Upgrade header 做出&lt;a href=&quot;https://www.nginx.com/blog/websocket-nginx/&quot;&gt;具体设置&lt;/a&gt;以实现长时间连接不断线的功能。&lt;/p&gt;

&lt;p&gt;因此，上面的有关Nginx的配置需要增添为：&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nano /etc/nginx/sites-available/default
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server {
    listen 80 default_server;
    listen [::]:80 default_server;
    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection &quot;Upgrade&quot;;
        proxy_set_header X-Forwarded-For $remote_addr;
        proxy_set_header Host $http_host;
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当然，最后两条和 WebSocket 无关，主要是把请求头补齐信息更全……&lt;/p&gt;

</description>
        <pubDate>Wed, 19 Jun 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/coding/kitura-deployment/</link>
        <guid isPermaLink="true">https://yo1995.github.io/coding/kitura-deployment/</guid>
        
        <category>swift</category>
        
        <category>mac</category>
        
        <category>coding</category>
        
        
        <category>Coding</category>
        
      </item>
    
      <item>
        <title>生活点滴随记 - 190609</title>
        <description>&lt;h2 id=&quot;整理想法文档&quot;&gt;整理想法文档&lt;/h2&gt;

&lt;p&gt;昨天晚上没能控制自己不碰设备，还是大半夜用iPad翻之前的博客。看到了不少有意思的内容，也受到了一些鼓舞——看近来的文字，从2018年的消极怠惰，到如今的充满动力，事情正在向好的方向发展，不禁无由头地乐观了起来。&lt;/p&gt;

&lt;p&gt;从去年9月开了一个文本文档，把日常的稀奇古怪的想法记录下来后，到如今也有近100条了。当时的设想是每次记录的想法有空就在周记里解构分析一下，然后归档。人算不如天算，总会有这样那样的事情打乱这个计划，于是积攒的想法也越来越多，甚至有些想法因为记录过于简单，到后来都无法重温、回味当时的心境了，只得丢掉。昨天看了之前的博客后，发现这事就像拍照片一样，没必要太在乎构图立意参数，随手一拍，回首看来总会有一些好的作品让自己觉得过程很值得；同样，随记的想法不一定有价值，但回头看看也蛮有意思。有时在生活中还会因此产生既视感——过去已在潜意识中或是在日常的分析中考虑过某个场景，如今真实地出现在眼前，心里也会小小地暗爽一下。总之，多想多记，总没坏处。&lt;/p&gt;

&lt;p&gt;把之前的想法简单整理了一下，大致分为了如下几个标签：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;编程&lt;/li&gt;
  &lt;li&gt;主义/宗教&lt;/li&gt;
  &lt;li&gt;内省&lt;/li&gt;
  &lt;li&gt;异想天开/设计&lt;/li&gt;
  &lt;li&gt;赚钱/花钱&lt;/li&gt;
  &lt;li&gt;写稿/大学之旅&lt;/li&gt;
  &lt;li&gt;音乐&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;还有其他一些琐碎内容，不过剩的不多。初步想法是回到周记的节奏，每次在记录日常想法的同时清理三至四个存档的想法，这样慢慢下来坚持到年底应该就能清空过去的存货了。还有其他一些琐碎的未归类的内容，也一并清理掉。&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;其他&quot;&gt;其他&lt;/h1&gt;

&lt;h2 id=&quot;读博---青椒---教职的另一重优势&quot;&gt;读博 - 青椒 - 教职的另一重优势&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;导师可以名正言顺地使用他人的时间实现自己的想法 - 这便是成为老师、教授的最大吸引力之一。在社会上，如果想找到同样学力的人为自己做类似的事情，付出的财富成本会高太多。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这两天在构思新的项目时，突然想到了成为高校教师、教授的又一种好处。一般人读博毕业二十八九岁，无论继续做一两期博后，还是成为青椒拿第一份青基，总之三五年后一切顺利的话就能迈入教师的行列。尽管这个年龄对于职场、对于工业界或者拼年龄的行业而言有些晚，但在另一层面上则是正当年，甚至极有优势。&lt;/p&gt;

&lt;p&gt;领导与实现。关键词不太准确，大致意思就是说在成为一名研究人员、导师之后，便获得了可以利用别人时间来实现自己想法的权力。这个优势说大不大，说小不小。&lt;/p&gt;

&lt;p&gt;粗略想来，在社会上，如果想让别人来帮你做事，需要付出什么呢？资本市场上答案很直接：老板付薪资，员工完成工作。薪资多寡与员工水平、所能完成工作的复杂程度基本线性相关。政治体制中，领导布置任务，下属负责落实，倘若这个体制是有效的，那么任务的难度与规模同样与领导的职级有密切关系——大领导办大事，小领导办小事。除此以外，我难以再想出其他让别人花时间为自己办事的法子来了。的确，社会并非理想模型，总会存在涨落，譬如卖个人情让别人帮忙，或是画个大饼给合伙人打鸡血，但总体而言，替人做事，无非权钱二字。&lt;/p&gt;

&lt;p&gt;对于教师而言，则有所不同。国内的高校研究生导师，多能以很低的代价获得教育、学力、学识水平远超社会平均的劳动力。试想，一个实验室三五个博士、十余个硕士研究生，要是放在社会上，每个月薪资就得数十万、上百万元。而在学校的场景下，导师拥有对学生工作时间的几乎无限的控制权。这就好比过去的一个笑话：“你浪费了每人一分钟，四十个人就是一节课的时间”，就好比导师拥有了一台多达28核心的志强处理器，倘若任务分配得当，进程间通信流畅，那么算力是极为可观的。&lt;/p&gt;

&lt;p&gt;时间就是金钱，而对于高等教育体制中的学生，他们的时间比社会中平均劳动力的单位时间更值钱。而作为教师，倘若能把这些劳动力合理分配，能够产生的价值也是很高的。当然，能否合理利用这些劳动力以创造真正的价值、能否把好钢用在刀刃上，则是另一个话题了。&lt;/p&gt;

&lt;p&gt;相比于权高位重的领导、腰缠万贯的资本家而言，成为导师的几率大了不少。一个高水平综合性高校有几十个专业，每个专业下都会有数十个实验室。而市面上叫得上名字的资本顶多百来个，远远比不上高校的数量。可能这样的比较不够合理，但可以考虑分段化的比较，把三者分别分为“三六九等”。顶尖高校顶尖实验室对比寡头企业的拳头部门对比国家省部级机关核心政务部门；中等高校中游实验室对比小有名气企业的普通部门对比市区政府部门；……然后再想这些对比中人才水平构成与付出的无差别成本的比较，或许高校真的具有优势。甚至，想想成为大领导和资本家的概率与年头吧！倘若不是平步青云一路开挂，怎么也不会比优秀的青年教师更年轻。&lt;/p&gt;

&lt;p&gt;想成为教师、教授，不可谓不困难。人生前30年中80%的时间都在学校中度过，贪婪地废寝忘食地汲取前人积累的精华以抵达某一特定领域人类知识的边界。但相比于其他的途径，一旦成功成为了教师，获得的支配时间的权利的收益是很高的。而且，学术的竞争机制相对较为公正透明，这也能一定程度上保证这些高级劳动力能够真正做到被“用在刀刃上”——更优秀的教授带领实力更出众的学生，研究更深刻的问题，而不像权钱有时并不受到客观规律的控制。&lt;/p&gt;

&lt;p&gt;当然，完全没有褒一贬余之意。成熟的机制存在自有道理。我想探讨的无非在博士终于成为导师后，其享有的能够利用别人时间的权利是令人艳羡的。&lt;/p&gt;

&lt;p&gt;每每我自己想到一个点子，觉得很有意思值得一试时，我都会先进行一些拆分，分析其复杂度究竟一个人能否完成。有时发现整个东西规模太大（所需人力太多而非指算力太高），非五六人花小半年无法搞定时，只好搁置或者限于意淫。我相信，随着科学技术、计算机技术的不断发展，过去许多需要大量人力的工作，劳动力会被逐渐解放出来——甚至算力已经可以日渐便宜地购得。但至于非得研究生、高级人才才能从事的工作，则总会需要极高的人力成本。在这方面，教职的优势真是得天独厚。&lt;/p&gt;

&lt;p&gt;Drew前日提到一个想法，说想做一个更好的“地球OL”似的角色扮演增强现实游戏。初一听觉得很有趣，但再一想发现复杂度很高。尽管涉及的技术都已经存在，但若想有效地把它们组织起来，仍需要大量较为高级的劳动力才可实现。对我而言，这样的事情止乎想象；而对Drew或是Ric这样的掌握了人力的教师、教授，这些有趣的想法或许有一天就能实现！&lt;/p&gt;

&lt;p&gt;倘若能以较低成本去试试自己的每个想法该有多好！如果说教职是一种特殊的财富，那么真金白银则是普适的财富。专门的财富可更高效率地转化为高级劳动力，而通用财富则只能按市场价竞拍了。无法走上学术的道路，也只能期冀自己早日被高价竞得，挣出足够的钱，再省吃俭用地用通用货币支付别人的劳动力来实现自己的想法了！&lt;/p&gt;

&lt;h2 id=&quot;再谈同龄人结婚的压力&quot;&gt;再谈同龄人结婚的压力&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;/life/uncertainty-unfolded-2018review/#%E9%82%B9%E5%AE%97%E4%BB%81%E7%BB%93%E5%A9%9A%E4%BA%86&quot;&gt;`&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;听闻又一个高中同学订婚，将于年内结婚。听到消息时候是深夜，不免再次伤春悲秋起来。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The topic about marriage at our age keeps on baffling me throughout these days. I got saturated. I got confused. I got motivated. I get bewildered about the whole thing.&lt;br /&gt;
The marriage, it is the whole plan for your route for the rest of your life, and your anticipation about the remainder of your adulthood. It is such a huge plan, that you need to always consider about it in a very thorough and deliberate way that you cannot let it go easily with passionate pique.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;当同学已经结婚，而自己还从未谈过女朋友时，便会有“一步慢步步慢”的紧迫感。这时候如果过于冲动，很容易做出轻浮不理智的选择，比如随便找个人就开始尬撩。反向的极端便是装作没听见，用逃避掩饰自己的焦虑。自从上次邹邹结婚，从消息出来到正式领证漫漫一年多时间的漫长消化、反思、建立抗体之后，我对同学结婚这件事的心理抵抗力有了些提升。别人早结婚是别人的选择，而我不必为此就全盘否定自己的想法与现状。&lt;/p&gt;

&lt;p&gt;跟Minerva聊结婚这件事很有趣。那天她带着儿子来上课，课后大家走掉后不知咋聊着聊着就聊到这个话题了。男人和女人对这个话题的认识不同，而不同年龄的女人也会产生不一样的理解。中年女性，整体而言对于婚姻都有比较成熟的价值观。无论是Natalie还是Minerva，都明白适合自己的才是最好的、不评判别人的生活的道理。而相对年轻的自己，则仍会受到同龄人的影响，有时不可避免地以己度人，或是以别人的标准去审视自己。&lt;/p&gt;

&lt;p&gt;压力肯定是有的，何况我才24岁。可想而知学姐的压力有多大，便更钦佩这些高知女性在面对传统文化、社会习俗、职场与家庭给予的压力时那份莫大的勇气。说真的，至少现在的我还没有充足的勇气去“横眉冷对千夫指”。或许只有足够宽阔、包容的眼界，才能让人脱胎换骨，去追随内心的声音。&lt;/p&gt;

&lt;p&gt;另一重思考：有时走在人生正轨上、顺风顺水的人会忽视下道人的感受。毕竟，并非身处相同的语境中而想要感同身受是困难的。当我们被大学录取，就很难理解复读同学的艰辛，哪怕读再多的纪实、亲眼看见他们的生活状态也于事无补——非得亲身经历才能理解；当他们毕业结婚，开始成年人生活，学校的过往便不再重要，而学校的语境也不再适用于大家闲聊的话题。&lt;/p&gt;

&lt;p&gt;为何挚友难得？若想友谊长存，要么碰巧人生节奏相当，从未你在河东我在河西；要么在常年的交往中产生跨越时间与阶级的“革命友谊”，不受现世琐碎的影响。前者要么运气极佳，要么只能靠大家一起原地踏步。就像“小镇青年”，多年以后仍旧和自己的发小情同手足，实乃囿于舒适圈。后者罕见，有时得靠一方拨云见日后不计回报地付出才可维持。所以，有时候觉得自己活了这把年纪竟然没几个知心朋友而暗自神伤并非坏事。要是到哪都有知心朋友，保不齐自己在原地踏步。&lt;/p&gt;

&lt;h1 id=&quot;内省&quot;&gt;内省&lt;/h1&gt;

&lt;h2 id=&quot;the-weather-is-another-consideration&quot;&gt;The weather is another consideration&lt;/h2&gt;

&lt;p&gt;不知什么时候开始，天气对我情绪的影响变得不可忽视。&lt;/p&gt;

&lt;p&gt;最早发现这个问题大概是14年冬天，而在15年底16年初天天在学十地下室吸臭气时最严重。甚至灰暗与雾霾天气不仅影响到心情，还让我手脚冰凉发麻，浑身乏力。那时每周一次的练球便是自己唯一的缓解方式。大口呼吸，试图把体内浊气排出，可吸入的是更为污浊的烟尘与雾霾……&lt;/p&gt;

&lt;p&gt;17年在杜克，夜晚周围的一片漆黑也曾让我心里有些难受。后来和Mary交流几次后有所缓解。而增大运动量则改善了这种情况。以前冬天不适合户外运动，但当我发现冬天Taishoff游泳馆人意外地少之后，每周的数次游泳让我身心状况好转。&lt;/p&gt;

&lt;p&gt;不得不承认，天气真的能影响我的心情，而我则用一切想得到的办法“鸡尾酒疗法”似的对抗这种影响。阳光、清风、鸟语花香、林间黎明、球场的汗水融入泳池的怀抱……&lt;/p&gt;

&lt;p&gt;这几天接连下雨对我产生了极大的困扰。下雨下雪是所有坏天气中最难对付的一种。因为没有车，一旦下雨我的活动范围极其受限，有时甚至连学校都去不了。当然，可以打伞走过去，但走去体育馆实在太远，想想都没有动力。没有运动，没有阳光，活动范围受限，很容易进入吃了睡睡了吃的恶性循环。经过一天蹉跎在家后，我决心第二天无论雨多大都要冲到学校去。&lt;/p&gt;

&lt;p&gt;然后第二天被淋成了落汤鸡……更可气的是过了半小时雨停了！&lt;/p&gt;

&lt;p&gt;在science drive冲下大下坡，满脸满裤腿满衣摆溅得全是雨水泥点子的同时，我大声骂着fword满嘴诳语，诅咒这恶劣的天气。心情似乎得到了一丝慰藉。&lt;/p&gt;
</description>
        <pubDate>Sun, 09 Jun 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/life/life-notes-190609/</link>
        <guid isPermaLink="true">https://yo1995.github.io/life/life-notes-190609/</guid>
        
        <category>life</category>
        
        <category>phd</category>
        
        <category>marriage</category>
        
        <category>rdfz</category>
        
        
        <category>Life</category>
        
      </item>
    
      <item>
        <title>来杜克后见的四个人 - 5</title>
        <description>&lt;h2 id=&quot;引&quot;&gt;引&lt;/h2&gt;

&lt;p&gt;四月初邹邹来校园参观的时候交换过关于Don’t judge的看法。排除完全主观、自己都能够意识到的偏见以外，评判仍旧是无处不在、甚至自己都无法意识到的。就像网上常说的——当发帖人说“说实话”、“讲真”、“实话实说”，这摆明了就是要胡说八道了；同样地，当一句话以“说句公道话”、“客观而言”起始，那十有八九是要开始疯狂judge了。&lt;/p&gt;

&lt;p&gt;即便如此，我还是要尽量“客观”地记录一些现在的所见所闻，权当做二十一世纪初留学生群体的纪念照、为以后回忆思量时作为时代的缩影提供一些参考罢了。&lt;/p&gt;

&lt;h2 id=&quot;yuanyuan&quot;&gt;Yuanyuan&lt;/h2&gt;

&lt;p&gt;曾有那么一瞬，圆圆让我想起了&lt;a href=&quot;http://mwenxue.com/news-151228/&quot;&gt;故乡&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;第一次见到她的时候，我就断定她是老家那边的人。甚至大胆猜测：太湖以东，扬州以南，嘉兴以北。&lt;/p&gt;

&lt;p&gt;她不像我任何一个初中高中同学，却又相见如故。她在人群中瘦瘦小小，并不起眼，但我却在人群中第一眼就看到了她。&lt;/p&gt;

&lt;p&gt;前日妈妈打微信来，说北京的嘉兴粽子要卖到14、5块一个，真的让我惊讶不已！上次吃正宗湖州人包的粽子，未曾当做稀世珍馐。未曾想，如今粽子也变成奢侈品了！&lt;/p&gt;

&lt;p&gt;近来全国范围内水果价格猛涨，也不知道是动了谁的奶酪，平常吃个水果都吃不起了。美国大樱桃好几十一斤、草莓也要好几十一斤，就连香蕉都要大几块钱一斤。妈妈跟我说这些的时候，我只是想，要是去年没有摔断手腕，现在是不是我也能“水果自由”了呢？&lt;/p&gt;

&lt;p&gt;多想早点挣些钱，让家里人先过几天好日子啊。曾经我还有点奢望做做学术，在学校里蹉跎蹉跎，赖在象牙塔里多一日便是赚到。可今年的几件事——Dr. Board的学阀世家、Patrick的毫无变通以及周围诸多同学财源广进狂收大厂offer后，我真正地把重心转移到学好写码、早日挣钱上来了。丰田宝马一小步，有车没车一大步。跨过这一大步，再寻思奔头，似乎也不是什么坏事。&lt;/p&gt;

&lt;p&gt;圆圆是个好姑娘，但她和她们也不太一样。像ZR、Hugo他们，想到苏南男生能凭着祖传的聪明才智从百万军中迈向硅谷，我是从心底为他们高兴。但女生则不一样，在科技领域、编程行业想要与全国各地的女中豪杰决一胜负，似乎并非易事。家乡女生没有李娜那种“看不下去就滚出克”的豪迈，就算吵架不落下风，真到撸起袖子加油干的时候还是略显柔弱。&lt;/p&gt;

&lt;p&gt;做不了什么，只能默默为她加油，祝这位姑娘能在往后的日子里不忘初心，用家乡人特有的一些特质为自己开辟广阔的天地。&lt;/p&gt;

&lt;h2 id=&quot;夏姓女子&quot;&gt;夏姓女子&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.renren.com/share/265208330/14262380509&quot;&gt;`&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;在杜克的两年多时间，还是错过了许多认识更多不同的人的机会。直到搬家，才认识了有一个典型的人大附毕业生。&lt;/p&gt;

&lt;p&gt;每往上走一步，认识的北京朋友里人大附毕业生的比例便高一份。今天跟夏同学闲聊的时候她提醒道：这意味着你接触到的圈子变高端了。愕然，转头回味时逐渐觉得很有道理。在北京，去清北的那五百来人的确代表了学生中最高水平，但当我认识像wm、bz、Minerva这样的学生后，才明白什么叫坐井观天。&lt;/p&gt;

&lt;p&gt;的确，每个重点高中都有那么一些有背景的学生，以师大附北大附清华附一零一为代表。但人大附……人大附可是那时个中翘楚！比你家庭优越的学生比你更聪明，比你还努力，这便是大部分人大附学生的构成。&lt;/p&gt;

&lt;p&gt;每次说到“人大附”学生的时候，我都会无端生出许多偏见。归根结底似乎来源于当时在仁华时被天赋碾压后产生的cynicism、阿Q精神。凭什么人家就能数学一学就通，而我吭哧吭哧半天就是弄不懂。于是除了数学上的自暴自弃以外，我还多了一分无端的、对于人大附学生的偏见——“精致的利己主义者”聚居地。&lt;/p&gt;

&lt;p&gt;直到高中，我才渐渐明白，世上并非非黑即白。这种幼稚的偏见也逐渐消散。但人大附学子仍旧有些特质，而这些&lt;a href=&quot;/life/life-notes-181121/#%E5%AE%9E%E5%B9%B2%E4%B8%BB%E4%B9%89&quot;&gt;特质&lt;/a&gt;与我们首师附的学生是不同的。人大附学生的背景更加多元，相较之下首师附初升高的学生所处的家庭环境、家庭背景都更为类似。曾统计过高中实验班同学家庭背景情况，以军人、教室、医生、企事业单位员工为主。而人大附中学生的背景可就不一样了——有像孙辰这样的能力出众的外区高手、陈铭书这样的学阀世家、翔哥那样的教师家庭、当当和Ethan那样的家境优渥的“有产阶级”、“中产阶级”，更有这样那样的中美洲移民、少将之子、以及许多背景不可言说的、上课见不到人影的讳莫如深型选手。在人大附中，真正的素质教育体现得淋漓尽致。高考不再是独木桥，而是八仙过海各显神通的大舞台。尽管多数学生依旧要靠分数过关，但分数高低与习题多少、与复习深浅不再完全是线性关系。这种非线性系统在不断发展中逐渐演绎成了另一种“军备竞赛”，高中生发顶会、高中生联合国演讲的新闻层出不穷；但至少在世纪初，仍旧是一个新颖而充满无限可能的选拔机制。&lt;/p&gt;

&lt;p&gt;夏同学便是一个典型的人大附中毕业生。当我敲出“典型”二字，你们可以理解为我要开始judge了。没错。人大附中中游学生，如果是北京人，大部分都会选择个差不多的北京高校，像北航、农大、北理、北师、央财、外经贸这样的第二梯队学校。一来离家近一切方便；二来也没必要跑到外地去花四年时间什么人脉都落不下；三来还能和本地的同学们常相会，一来二去有着无限的可能。&lt;/p&gt;

&lt;p&gt;夏同学想来经济条件应该是不错的。走之前留给我的物质粗略估算得有一百刀以上。更别说五月整月在各大二手群的倾情大甩卖——我看着都觉得暴殄天物！原价上百的吹风机二三十就卖、原价近千元的相机一二百也卖、吃穿用度尽是高档产品——每一件让我买都得思前想后犹豫一周那种。更别提日常用品——从日常消耗品的档次最能看出消费水平——不仅质量好，数量尤其多。美式销售逻辑在Costco和Amazon身上体现得淋漓尽致——一买就是一年的。买蔡司的擦镜布一买就是小一百张；垃圾袋三盒十几卷……要知道我们三人半年才用完一卷！剩余的全新百洁布之众，让我轻易就做出了以后擦自行车每次用一个新的的奢侈决定。凡此种种，毋需赘述。&lt;/p&gt;

&lt;p&gt;除此之外，她的言行举止也四平八稳。写到这里又想贴标签了，理工男、北京风度、受过良好教育……总之，良好的教育水平是时时刻刻体现在人的一举一动当中的。&lt;/p&gt;

&lt;p&gt;还有鞋架上杜克高尔夫俱乐部的会员卡……以及立在墙边的一支云淡风轻的wedge……&lt;/p&gt;

&lt;p&gt;在北京，每年都有无数的这样的家庭条件优越、接受过世界较高水平高等教育的学生从人大附中走向社会。这让我看到了十年后、二十年后一个欣欣向荣，人民物质与精神生活极大丰富的北京。脑中闪现的《最后的棒棒》、龙古村小男孩向我伸出的双手，与眼前天天可见的快乐与幸福的新时代年轻人使我逐渐迷惘。究竟哪个才是真实的中国？抑或二者都是真实存在、并行不悖的当今社会中的普通民众？&lt;/p&gt;

&lt;p&gt;当“人民日益增长的物质文化需要同落后的社会生产之间的矛盾”转变为“人民日益增长的美好生活需要和不平衡不充分的发展之间的矛盾”时，我似乎有些明白个中区别了。但我愈发觉得自己接受的政治教育已经无法解答很多当今社会中的现象与问题了。希望能有一天……&lt;/p&gt;

&lt;h2 id=&quot;清华&quot;&gt;清华&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://qsgz.nnsz.com/contents/77/12253.html&quot;&gt;`&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;这个姑娘是清华来杜克读JD的学生。父亲是法律系统厅级干部。自知自己不该肆意窥探别人隐私，但我仅仅是把姓名放到谷歌中一点而已。&lt;/p&gt;

&lt;p&gt;我看到了一个五位数的数字。我不想再去侵犯隐私以满足自己的好奇心，于是关闭了页面。&lt;/p&gt;

&lt;p&gt;在初夏的酷热涌入阳台与屋内空调冷风冲击碰撞形成的湍流中心，我庆幸于自己曾有机会与杜克学子共处大厦之下。&lt;/p&gt;

&lt;h2 id=&quot;生辰辞&quot;&gt;生辰辞&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.renren.com/blog/334504317/905636559&quot;&gt;人人&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;十年之后&lt;br /&gt;
我们是朋友 还可以问候&lt;br /&gt;
只是那种温柔 再也找不到拥抱的理由&lt;br /&gt;
情人最后难免沦为朋友&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;今天是杨辛辞的24岁生日。跟我并没有关系。&lt;/p&gt;

&lt;p&gt;但也是孙辰❤Physics发布这篇日志的六年纪念日。六年前的今日，杨家有女初长成，养在深闺人未识。&lt;/p&gt;

&lt;p&gt;多年以前，我们都有个喜欢的姑娘。命运与时光令我们天各一方。&lt;/p&gt;

&lt;p&gt;多年之后，我们仍是朋友，但昔日的温柔早已找不到借口。&lt;/p&gt;

&lt;p&gt;岁月如梭，我们似乎无法忆起那时的细节，甚至是否爱过都难以捉摸。那时青涩懵懂的情愫，究竟是什么？&lt;/p&gt;

&lt;p&gt;“无论生活怎样闹，之后每天都要过好。”简单的祝福中囊括了多少思恋与期许。&lt;/p&gt;

&lt;p&gt;于幸福的人而言，天遂人愿似乎理所应当。于不幸者而言，各自有各自的大不幸，而所能应对的便是乐观而积极地在深浅不一的生活交织中寻找一个又一个“小确幸”。&lt;/p&gt;

&lt;p&gt;愿天各一方的二人，终有所获；愿一切跨越千山万水的念念不忘，必有回响。&lt;/p&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;p&gt;如果你看到这里，一定会明白为什么prejudice已经深入我的骨髓，也会理解来到杜克后西方文明don’t judge原则曾何等地震撼着我被千百年东方文明所浸淫的内心……仍在尝试，而且已经看到了改善的趋势。&lt;/p&gt;
</description>
        <pubDate>Fri, 17 May 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/school/two-girls-05/</link>
        <guid isPermaLink="true">https://yo1995.github.io/school/two-girls-05/</guid>
        
        <category>girls</category>
        
        <category>lifestyle</category>
        
        
        <category>School</category>
        
      </item>
    
      <item>
        <title>他们毕业了</title>
        <description>&lt;h2 id=&quot;写在前面&quot;&gt;写在前面&lt;/h2&gt;

&lt;p&gt;毕业的氛围已经萦绕在校园周围许久。到了五月的头上，四处便弥漫着喜悦与成就交织的情绪。目送身边大多数同学完成人生学生生涯最后一段旅程，我也感慨良多。从最初的羡慕、捶胸顿足，然后自怨自艾，然后暗自期许后怅然若失，最终慢慢释然而为他人祝福。仅以今日所见所闻所思所想简记这些日子来对于最后毕业的感触。&lt;/p&gt;

&lt;p&gt;尴不尴尬的真是无所谓了。以前看自己初中高中写的很多东西，一点都不尴尬，反而惊叹于当时那种洒脱而轻松的笔触。反倒是年纪大了，写的东西却越来越啰里啰嗦扭扭捏捏。落子无悔，现在能做到想到什么就说什么都不容易了。&lt;/p&gt;

&lt;h2 id=&quot;整装待发&quot;&gt;整装待发&lt;/h2&gt;

&lt;p&gt;前日，当项目协调员Anthony Strimple发出邮件诚邀毕业典礼志愿者时，我想都没想就报了名。无它，我也想见证昔日的熟人、同侪、朋友、学子一个个走上人生学术生涯最终的舞台，演绎光彩熠熠的最后一舞，书写分量十足的谢幕演出。&lt;/p&gt;

&lt;p&gt;整个三月四月，我都处在一种惶惶不可终日的焦躁与逃避之中。本以为船到桥头自然直的实习求职之路，并未像我想象地那般徐徐展开。整个人有些憔悴，游泳时总觉得膈膜顶着肺泡，肚子滞胀而下垂，一边游一边反酸水儿，总想游完这圈就算了。满脸的嘴毛胡子头发疙瘩包也欣欣向荣地春意盎然着，而我却浑然不知。自己总喜欢钻牛角尖——不达目标不整理仪容。本科说大三搞个SCI就剃光头——果然没有搞出来。说大四男子铁三就买碳刀——大四毕业才重新学会游泳。以至于录了ENST就不在申请、GRE拔得头筹等flag，一个个成了戳脊梁骨的笑柄。&lt;/p&gt;

&lt;p&gt;但无论如何，我又有一种混不吝的截断措施。只要水到渠成，生活又能一下子走上正轨。大清早闹铃没响就清醒过来，洗头刷牙剃须吹干，一气呵成。今天是个大日子，我告诉自己。无数双国内外的眼睛都看着呢，可不能给我的同学们丢了人！&lt;/p&gt;

&lt;p&gt;我整个学生生涯，似乎都是起个大早赶个晚集。从小虽然没补习太多，但硍节儿也都硍过。仁华上过，跟人大附预招谈笑风生过；保送中考分数也堪称睥睨，高中屡次在悬崖边游走也没湿过鞋。但是，人生要紧的就那几步，差之毫厘也比不过一步走好。大学本科是一趟趟列车。有些人坐了高铁商务座，有些人坐了高铁站席；我坐了绿皮车包厢。也罢，嘎油嘎油赶集去咯。&lt;/p&gt;

&lt;p&gt;十点五十，早早地就来到礼堂门口。Tony西服笔挺地站在门口。往来穿梭的净是各色学校的Doctoral Gown. 同级的同学们打扮的漂漂亮亮。男生皮鞋锃亮，女生满面红光。士别三日当刮目相待，学生们摇身一变，一个个变成了即将踏向社会，朝气蓬勃的时代领军人。&lt;/p&gt;

&lt;p&gt;入学时，我依稀记得专业里硕士大概有一百一十人左右。数了数毕业生名单，九十有余。剩下的二十人去哪儿了呢？或是找到自己的兴趣，转去其他专业；或是学业受阻，不得不暂别校园。或许也有我这样的，错过了frame rule，只好赶个晚集的二乎仔。总之，志得意满的年轻人们，已经逐渐褪去学生的稚气，而变得成熟稳重、颇有番职场中人的感觉了。&lt;/p&gt;

&lt;p&gt;在以前，每次看央视“我二十四岁”广告时都有些惴惴不安。别人二十四岁时能像那样朝气蓬勃，卓有成就，我二十四岁时能像他们一样吗？自己很久就是个相信命运的人，觉得无论怎么扑腾水溅跃，历史的洪流终将滚滚流去。并无王佐之才，只求偏安一隅。果然到了二十四岁，生活并未变得和往常不同，生活却又变得大不相同，让我不禁感慨，哦，原来二十四岁就是这样的啊。却也再没有十七岁时的思绪万千。&lt;/p&gt;

&lt;p&gt;无数次问自己，你准备好了吗？有时的答案是肯定，有时则是否定。无论如何，肯定的比率逐渐增高，而自己也知道未来的人生将会越来越少地出现“我完全准备好了”的处境。所谓有钱没钱回家过年，无论现在准备好没有，到了这个节骨眼儿上，怎么都得背上行囊，奔向远方了。&lt;/p&gt;

&lt;h2 id=&quot;和drew的三次对视&quot;&gt;和Drew的三次对视&lt;/h2&gt;

&lt;p&gt;我和Drew都知道我今天为什么在这儿。或许Drew忘了，或许没忘，我不得而知。但我永远记得。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/globalvariable.png&quot; alt=&quot;全局变量&quot; /&gt;&lt;/p&gt;

&lt;p&gt;永远是一个很重的修饰词。她有时带着几分稚气未脱、几分执迷不悟、几分舍我其谁的毫无由头的大无畏的勇气、几分自以为看破一切——自以为看破自己当局者迷——自以为认清了生活的真相后还依然热爱它的“死猪不怕开水烫”。我很谨慎地在生活中，在记忆中，在文章中用永远这个字眼。就好像全局变量，一旦声明就要极小心地使用。而作为一个学艺不精的半吊子C++程序员，在“百尺竿头更进一步”这方面我当然是不遑多让。浩大如“我永远热爱自己的祖国——中国”（小学）、“我永远喜欢深蓝色”（学龄前）等定义了我的世界观与价值观的事件；渺小如“我永远记得和Drew第一次约谈的场景”（2017-03）、“我永远记得我对一楼茅坑说过的话”（2013-02）等等鸡毛蒜皮的小事，我都一一全局存储在脑海之中。极度混乱，不是吗？不太优秀的大脑有时也搞不清哪些永远能动哪些不能动了，仿佛给自己套上了“女德班”的枷锁。&lt;/p&gt;

&lt;p&gt;和Drew的第一次对视，是在不经意间发生的。和Tony Erin Sue等一众非学术人员尬聊时，我看到了不常见的穿着的宾大博士礼服从礼堂中走了出来。我对他点头，他对我抿嘴，心中暗叫不好。&lt;/p&gt;

&lt;p&gt;和Drew的第二次对视，带着几分期冀与疑虑。家长们鱼贯而入，我在门口疲于应付。走来的同学似乎都是熟面孔，满面春风地向我打招呼，自然也得笑脸相迎。正如上面说的，有点纠结迷惘——大家都愉快地毕业了，而我却要孤独地在屏幕前修行几个月。有时嘴咧太开了，脑子里便会恶狠狠地警告自己：别得意忘形了，人家毕业是人家的成就，你还没毕业呢！嘴角不禁不受控制地下坠，倘若有镜子一定能看到一副哭笑不得的假笑脸……&lt;/p&gt;

&lt;p&gt;Drew又从我的背后走出。我毫不避讳地与他四目相对。他又抿着嘴点点头。我的心理瞬间就著就一部《罪与罚2019》。拉斯科尔尼科夫在遥远的东西伯利亚归于热寂，而我却在嘈杂纷繁闹市中央茕茕孑立。究竟他还认识我吗？他看穿了我在想什么吗？我看穿了他看穿我的所思所想吗？无数关于承诺、爱与理想的回忆瞬间占满了整个脑海。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/smirk.jpg&quot; alt=&quot;尴尬而又不失礼貌的微笑&quot; /&gt;&lt;/p&gt;

&lt;p&gt;和Drew的第三次对视，尴尬而又不失礼貌的微笑。毕业典礼落幕，场外众人排队与Drew合影。大家学士服学士帽一应俱全，欢欢喜喜地和昔日严师做最后的告别。我想，Drew还是认得我的，毕竟我的大白衬衫和周遭的黑色礼服格格不入。一日闹僵，或老死不相往来，或相逢一笑泯恩仇。或许Drew只喜欢对那些自以为能力出众的人出手，而我显然出众错了地方。&lt;/p&gt;

&lt;p&gt;唉。2017年春天的那天，我第一次见到了刘思远两口子。他们还在跟我讲述工大的altera课程对工作多么没有帮助时，我的思绪早已飘到了和Drew尬聊的15分钟之间。当他不止一次提到Aaron Franklin和IDK时，我已经意识到（却很久没有接受）——&lt;/p&gt;

&lt;p&gt;我不会读博了。&lt;/p&gt;

&lt;p&gt;但我从未想到竟然是以这样一种令人咋舌、令人一边脸红一边煞白的近乎羞辱般的方式彻底击碎我的念想。&lt;/p&gt;

&lt;h2 id=&quot;喜悦&quot;&gt;喜悦&lt;/h2&gt;

&lt;p&gt;人生能有几次毕业呢？对大多数人而言，人生最重要的毕业当属Commencement，本科毕业典礼。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/familia.jpg&quot; alt=&quot;家&quot; /&gt;&lt;/p&gt;

&lt;p&gt;对我而言，小学毕业早已印象模糊，初中根本未曾毕业过，暑假回来身边还是那些人。大学本科毕业更是走过场，唯一值得称道的也就是和肖老师照了张“断臂青年”合影。诚然，本科四年，我们既像养尊处优的纨绔子弟，又像被关在金质牢笼中的金丝雀。聚是一团火，散是满天星。毕业时27个人有将近20人选择了博士这样的commitment，不可谓不误人久矣。&lt;/p&gt;

&lt;p&gt;本科毕业那天我是啥样的？虽然只是几年之前，但我确实记不太清了。蓝天无云大太阳，和父母合了不到十张影，和同学自拍杆瞎拍了几张，一个二乎同学院学生拿我爸背影当头像？？你瞧，只有瑰怪非常之见闻才能引人注目。&lt;/p&gt;

&lt;p&gt;至少，在回到编辑器前，我始终是深受朋友们的感染、内心洋溢着十足的喜悦的状态。看着中国和印度家长为主的家人们，从不远万里的家乡风尘仆仆光彩熠熠地赶到世上不起眼角落的宁静校园，给昔日低声细语的周遭带来嘈嘈切切的生机与烟火气，我真是打心底地高兴！你想啊，人生究竟能有几次毕业呢？至少对于绝大多数人来讲，这就是学生生涯的最后一天，句号，死句号。你们拿到了科学大师的称号，既不是哲学医生，也不是工程师单身汉。回头看看，不可谓不算一份真正的荣誉。寒窗十二载，又过六七年。学生生涯学术生涯的终点线后，是湛蓝的天空、碧绿的青草、穷极一生都无法通览的知识宝库，以及无数与你走过相似人生旅途、过五关斩六将的同僚……而今天，你们加入了这个群体，成为了浩浩人类文明的又一个注脚。&lt;/p&gt;

&lt;p&gt;至少，对于志愿这件事，我很自私。我只志愿参加与人情感交流的活动，而逃避那些对着没有生气的物块夯体力的志愿活动。多好啊！身处这样的充盈着喜悦与幸福的饱满情感的场合之中，哪怕心里有再多苦痛，也能暂时放下。人类因为情感而成为万物之灵。共情，与同类分享感情，这种美妙而独特的能力实乃宇宙最为神奇的馈赠。&lt;/p&gt;

&lt;p&gt;珍惜这一刻！无论我将走向何方，都将永远记得一簇簇笑靥如花。珍惜这一刻，今后无论有再多苦难，这些美好的回忆仍会在心底生根发芽。&lt;/p&gt;

&lt;h3 id=&quot;hooding时的小插曲&quot;&gt;hooding时的小插曲&lt;/h3&gt;

&lt;p&gt;游讴韩的穗子掉了只是小引。后面老哥抓了女孩儿的脖领自顾自带上，照完相后又抓耳挠腮地脱下塞还给对方的操作，成为今日全场最佳，引得全场爆笑欢呼、起立鼓掌。许多年以后，当人们慢慢老去，那个大爷仍能骄傲而不失调皮地提起今天的惊人之举。这或许就是他学生生涯的谢幕演出。&lt;/p&gt;

&lt;h2 id=&quot;合影&quot;&gt;合影&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;我听见雨滴落在青青草地&lt;br /&gt;
我听见远方下课钟声响起&lt;br /&gt;
可是我没有听见你的声音&lt;br /&gt;
认真 呼唤我姓名&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;和John Board的合影似乎提醒了我：这一别，有些人或许难再相见。&lt;/p&gt;

&lt;p&gt;毕业典礼前一天，列出了一个小小的名单，写着十几个在杜克相熟、希望与之合影的姓名。专业里点头熟的人不少，但真正说上过话儿，有过共同回忆的人并不多。自问这两年并不孤独，但也未曾尽心尽力投入社交。直到最后，才想起——&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;此去经年，应是良辰好景虚设。&lt;br /&gt;
便纵有千种风情，更与何人说？&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;真正出了学校，能说得上话的人还有几多？些许后悔，没能熟识更多的有趣的朋友。暗自庆幸，史一川和邓以诚都是人群的中心，跟着他们也能蹭个脸熟。尴尬而又不失礼貌地和朋友们合影，我便是那苍白花海中一朵明媚的黑。&lt;/p&gt;

&lt;h3 id=&quot;合影与回忆&quot;&gt;合影与回忆&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/group_photo.jpg&quot; alt=&quot;合影&quot; /&gt;&lt;/p&gt;

&lt;p&gt;合影对我而言的另一重重要意义，便是类似于灯塔一般指引着人生的时间线。日复一日，很多时候没有重大事件的日子都悄悄溜走了。哪怕只是一周之前，倘若不认真回忆，我都记不起之前的细节。这学期向Dr. Hughes学习了一些时间管理的方法，其中重要的一条便是使用日历记事。每周我都会争取抽时间梳理一周内时间的分配，从而更好地回顾本周、估计下一周的时间安排。&lt;/p&gt;

&lt;p&gt;合影亦是如此。人生旅途中，有时会渐渐忘了那些岁月与谁人共赴。一张合影便能瞬间将你带回那些欢声笑语刻骨铭心的日子。有时翻翻以前的朋友圈，翻翻老照片，看到一张合影，心底会由衷地笑出来。纯粹的快乐。回忆会抹去那些不愉快的细节，留下的只有纯粹的情感。看着照片里那时恣意憨笑的自己，嘴角不由自主地高高挂起。&lt;/p&gt;

&lt;h2 id=&quot;拍照&quot;&gt;拍照&lt;/h2&gt;

&lt;p&gt;有时会觉得，会拍点照片是一个不错的爱好与技能。&lt;/p&gt;

&lt;h3 id=&quot;拍照的倾向&quot;&gt;拍照的倾向&lt;/h3&gt;

&lt;p&gt;自从2015年夏天后，我逐渐喜欢上了拍拍生活。&lt;/p&gt;

&lt;p&gt;在那之前，主要用来拍照的只有两台佳能卡片机。G9用来拍些重要的照片，如团委的活动、班级集体出游、大家一起练鼓。A1000用来拍不重要的照片——骑车随拍、懒得抄作业题目随手一拍、看到远处奇怪的东西，看不清当望远镜随手一拍。以至于2012年附近的照片存档中有不少奇奇怪怪的照片舍不得删。&lt;/p&gt;

&lt;p&gt;没错，拍下的照片总是舍不得删。成长的年月里，数码相机曾经是个奢侈品，胶卷傻瓜机拍一张就耗费一张底片。以至于每次拍之前先要好好凹造型，直到一切安排停当才会诚惶诚恐地按下快门。这个习惯一直延续到了现在，用相机拍照时仍旧非常谨慎。不仅为了节省快门，也为了减少后期挑选的繁杂，更为了那一份不确定的紧张与期冀——此时此刻此情此景仅此一张，是好是坏内锐外奶听天由命！如此，我拍了不计其数的废片，也收获了屈指可数的精品。痛并快乐着，每每感慨这么好的画面被我拍废了的同时，也会暗戳戳有种受挫的快感。&lt;/p&gt;

&lt;p&gt;拍风景，自然是一种高雅的口味。摄影艺术在更高层次上，其实是与油画有异曲同工之妙的。无论构图、色彩、主题，一张好的照片能好到什么程度？“拍的像画儿似的”，栩栩如生，风景如画。然而，有些风景并不随时间流逝而改变，拍着拍着便会心中生厌。小时候拍花花草草，以后便不再着迷；中学拍结构建筑，也随着时间流过而冲淡了兴趣。渐渐地，我明白了，只有人，才是照片的灵魂，才是区分摄影与其他艺术的最重要的因素之一。人的情感、人的反应、人与文化，是大自然不曾预料的、独一无二的风景。&lt;/p&gt;

&lt;p&gt;另一种理解：照片是四维时空的二维化。都知道《三体》中的二向箔，殊不知人类早已掌握了类似的手段，而摄影在这种层面上甚至是一门艺术。在拍摄三维空间时，平面摄影师往往在乎构图、补光、取景、光学参数，而忽视了时间轴的存在。时空摄影师则不然，他们能够感知世界的变化，能够在脑中具象化时间轴，能够望向过去、着眼当下，也能短暂地预估未来。多么美妙啊！手中的仪器通过一系列复杂的、凝聚了数百年人类智慧结晶的定理与公式，将我们身处的时空压扁成了一个最好的纪念品。你又怎么舍得删除它呢？&lt;/p&gt;

&lt;p&gt;拍风景，当然好，不过只是把一个时间位移几乎为零的三维空间降维，缺少了那份不确定性，也就缺少了潜在的精彩与决定性时刻。&lt;/p&gt;

&lt;p&gt;Decisive moment，不知道是我自创的名词还是早已有之。对我而言特指那些从宇宙诞生到热寂的所有事件视界中唯一的交点。在那一刻，你按下了快门，世界从此改变。世界从未相同。&lt;/p&gt;

&lt;p&gt;而生活，那些最不经意的时光悄悄溜走的场景，是决定性时刻的最大宝库。&lt;/p&gt;

&lt;h3 id=&quot;拍照的倾向2&quot;&gt;拍照的倾向2&lt;/h3&gt;

&lt;p&gt;最为真实的人物状态。&lt;/p&gt;

&lt;p&gt;其实是一种偷懒的行为。商业广告那样的模特摆拍绝对是非常专业而值得学习的。技巧已臻化境，倘能用在自己的拍摄中一定能大大提高出片水准。但我还是喜欢随手拍。原因之一如上，随手拍到的时刻绝对是独一无二的，不像棚拍那样可以反复精调。原因之二则与记忆有关。&lt;/p&gt;

&lt;p&gt;自己的记忆力不好，拍下这些时刻，好比对四维时空中自己生活的reconstruction。就好比做图时，对三维图像常采取切片的方式以观其内部情况；四维也一样，更多的采样能够更好地还原当时所思所想所感所悟。&lt;/p&gt;

&lt;p&gt;以后翻回头来看看，哦，原来当时我是这样的！或许我当时是这么想的？……&lt;/p&gt;

&lt;p&gt;这也是我有点喜欢拍视频的原因。视频本质上和一系列图片差距不大，若不是非得精确记载的事件，拍些照片效率更高。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;本想说拍照能促进和人交流，也算是一个圈子可以结识朋友。但想想自己似乎并未通过拍照认识什么朋友，罢了……不过还是拍了不少有意思的照片，每一张都是一个动人心弦的故事！&lt;/p&gt;

&lt;p&gt;拍照，也是讲故事喔！&lt;/p&gt;

&lt;h2 id=&quot;人生的高速&quot;&gt;人生的高速&lt;/h2&gt;

&lt;p&gt;猫猫狗狗，爸爸妈妈，家长里短，结婚生娃。&lt;/p&gt;

&lt;p&gt;晚上和他们一起吃饭。大四川，在卡瑞县城附近，开车走高速都要三四十分钟。就像邹宗仁当时来对我抱怨的一样——杜克附近的中餐馆，实在不够方便快捷。嗨呀，为啥非得吃中餐呢？&lt;/p&gt;

&lt;p&gt;我一直没啥口福。自己出去玩吃饭肯定没有很高优先级，去美食天堂台湾结果吃了好几顿711；去川渝吃了好几顿北方饺子馆；去洛杉矶吃了四次入和出汉堡……一直渴望未来的女朋友会吃，能拯救我这个对尝鲜提不起兴趣的小兄弟。&lt;/p&gt;

&lt;p&gt;但我也喜欢吃好吃的，只要别太麻烦。柴氏、楼纪、素炒香锅，逮着可劲儿往里塞，才不管腻不腻呢。总之，不用专门付出代价就能吃到好的，从来不客气。&lt;/p&gt;

&lt;p&gt;要我说，南美风味儿不算太赖，尽管有些菜肴偏酸辣口味。南美很多菜用料很坐实，舍得用料的菜一般都比较好吃。当然也不绝对，像炸鱼薯条或者美式汉堡那种，像Michelle说的美国大妈拿着奶酪块当晚饭那种，那还是旁边儿稍稍吧。&lt;/p&gt;

&lt;p&gt;扯远了。当邹宗仁毕业结婚时，我第一次感到自己在不可避免地变老，迈向社会，迈向中年。当今天坐着游讴韩的车在夹道的树木中疾驰时，我体会到了一步慢步步慢的焦虑。&lt;/p&gt;

&lt;p&gt;她们两家都有着比较稳定而持久的感情，工作学习也都比较顺利，一切向着光明的未来稳步迈进，婚姻、、事业与家庭的话题自然也水到渠成。听着她们聊这些看似遥远的事情时那种从容不迫的淡然，才会猛然意识到她们已经毕业了。有些话题还是很年轻，像扎个耳洞的扭扭捏捏；有些话题则超越了年龄地成熟，如早拍婚纱不然就得变成亲子照。&lt;/p&gt;

&lt;p&gt;留学的年轻人风靡养猫养狗，今天我算是有了新的理解。不仅是异国他乡精神的寄托生活的陪伴，更像是一场对于新一代家庭的模拟演习。邓以诚的猫，喂得肥肥胖胖，宠她爱她百般呵护，隔天在朋友圈晒一晒美照引得无数艳羡；陆星宇的猫娇生惯养却又漫不经心——猫生只吃猫罐头，离了主人只好忍饥挨饿，主人却满不在乎大大咧咧地留它看家；游讴韩的猫则更像家庭的一份子，既是家人交流的媒介与桥梁，又是共同责任分担的试金石，更是欢声笑语的源泉。嗨呀，像极了家里的小宝贝儿！&lt;/p&gt;

&lt;p&gt;见父母自然是结婚前要不断经历的过程。儿子带着女朋友见父母，女儿带着男朋友见父母，儿子带着父母见女朋友家人，女儿邀请家人来参加和儿子的婚礼。两个小家汇入一个大家，文明得以延续，人力物力知识财富得以传承，人类生生不息不断发展的动力皆在于此。跨出第一步总是困难的——当然笔者连入口在哪都还没找到。能走到如今这样成熟稳定的关系，自然少不了磨合。&lt;/p&gt;

&lt;p&gt;宁拆十座庙，不毁一桩婚，我老是跟任嘉毅孙辰说这句话。是好是赖，先试试看。别动不动就闹脾气耍脸子。两人的结合总得有个互相熟悉，互相磨合，互相谦让的过程。自己爽了对方可能就遭殃了。正像歌词——&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;爱情 爱情 　
原本就是一个人的事情&lt;br /&gt;
一个人动情 一个人平静&lt;br /&gt;
一个人付出 一个人任性&lt;br /&gt;
爱情 爱情&lt;br /&gt;
慢慢变成两个人的感情&lt;br /&gt;
一个人发疯 两个人心疼&lt;br /&gt;
一个人牺牲 两个人享用&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;又扯远了。今日入席的四对儿都有比较稳定的感情基础，经济条件自然也是杠杠的，到了谈婚论嫁的年纪一帆风顺，不可谓不是人生得意须尽欢。暗下决心，早日拿到入场券，早日摆脱门外汉。&lt;/p&gt;

&lt;h3 id=&quot;成人的饭桌&quot;&gt;成人的饭桌&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/dinner_table.jpg&quot; alt=&quot;宴席&quot; /&gt;&lt;/p&gt;

&lt;p&gt;爸妈和子女，天然的对偶，最长情的陪伴。聊着聊着，她们还是聊到了爸妈。没能不远万里地赶来参加毕业典礼，索性就回忆下那些童年趣事吧！&lt;/p&gt;

&lt;p&gt;讴哥：“我妈生我弟弟以后便辞退不再当幼教了嘛……省略……弟弟五岁时大家总是戏弄他，他一气之下拿毯子裹着方便面就要流浪远方……”&lt;/p&gt;

&lt;p&gt;冯缘：“我妈说你的生日就是我的受难日……省略……一年我忘记自己生日，妈妈想起了还问我为什么不过生日，我……哈哈哈”&lt;/p&gt;

&lt;p&gt;亲妈系列。恰巧是母亲节，在这样一个特别的日子，逐渐脱去稚气的他们似乎越来越能理解与体悟来自母亲的纯真的爱，无私的爱，毫无保留的爱。或许世上没有什么能与这种亲密关系相比了，这世上唯一给予你一切而时刻准备着为你奉献更多的人。而过不了几年，我身边的她们也会陆续地升为人母。我想，她们一定会是合格的，毫无保留地爱自己子女的母亲。&lt;/p&gt;

&lt;p&gt;今天的饭桌上没有未成年人。似乎学生也只有我一个（废话）。不止一次参与这样的宴席，从最初的懵懂无知到格格不入的尴尬，再到如今的愈发从容坦然，人是在慢慢成长的。天南海北的父母齐聚一堂，他们熠熠生辉的子女踌躇满志。甭管饭桌上谈论什么话题，杯子里装的是饮料还是酒，这文化，算是传承下来了，算是交接棒了。这或许是我第一次以一个局外人的身份参与一场主角不是父母辈的宴席。这是我人生中极为普通的一天，但多年以后会看，它会不会是我青年生涯的最后一天呢？&lt;/p&gt;

&lt;p&gt;成人的饭桌，自然少不了成人的话题。没必要是父母辈的话题，但一定是成年人的话题。想脱口而出蠡口题解，大家善意地劝回了——毕竟，在座的各位谁没精通蠡口呢（当然还是我除外）。&lt;/p&gt;

&lt;p&gt;同学这桌算上我11人，家长6人。11人这桌总身价年薪破百万美元，赶得上世界最顶尖商业体育联盟的中产合同了。说真的，坐在一群百万富翁当间儿，我还真的是局促。虽然我们可以聊的话题并没有什么不同，但难免会有心理压力。同样也会心生疑惑：我来了杜克，究竟是想和他们共聚一堂，还是和众人分道扬镳？&lt;/p&gt;

&lt;p&gt;从目前的趋势看，较好的结果似乎就是我踩着前人的足迹走向光明的转码通途。这被定义成一种成功，连Prof. John Board听到都会讲”Well, I’ve definitely heard of Facebook!”。哈，当我第一次听他提起他的父亲也是一名终身教授，而他也是杜克的终身名誉教授时，感慨或许在西方，学阀也是有世家的！而西方的学阀世家，很可能在我们辛亥革命时就已经根基稳固了！而我本来差点就走向一条完全不同的道路——去苏蓓蕾，学法语，找朗讯的实习，在巴黎斯坦惶惶不可终日。孰好孰坏，只能交由平行宇宙来判断。我并不满足与现状，但我似乎也只能泰然处之。&lt;/p&gt;

&lt;p&gt;谷歌、脸谱、亚马逊，这些公司对于长辈们而言或许如雷贯耳，但终究只是一个响亮的名字罢了。借着酒劲儿讨论了半晌西雅图和旧金山谁更靠北的问题，似乎子女未来的细节他们并不在乎，白花花的银子更有说服力。到了这样人生的冲积平原阶段，似乎也没必要在意那么多细节了。乐呵着，知道自己的娃有大能耐就够了。真的，爸妈为你感到骄傲，我们可能也帮不上什么忙了，这一棒交给你，你去奔明天、奔未来吧！&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/contentement.jpg&quot; alt=&quot;爱的凝视&quot; /&gt;&lt;/p&gt;

&lt;p&gt;于是，这成年后的真正成人礼，这毕业后的真正毕业典礼，在卡瑞的风雨中，在北卡无边无垠的森林中，在无数个小家汇聚成的大家庭中，完成了最普通，最不起眼却又意义非凡的完美谢幕。&lt;/p&gt;

&lt;h2 id=&quot;离去&quot;&gt;离去&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/201905/path.jpg&quot; alt=&quot;未来的路&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;但我不能放歌，&lt;br /&gt;
悄悄是别离的笙箫；&lt;br /&gt;
夏虫也为我沉默，&lt;br /&gt;
沉默是今晚的康桥！&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;十年之前&lt;br /&gt;
我不认识你 你不属于我&lt;br /&gt;
我们还是一样 陪在一个陌生人左右&lt;br /&gt;
走过渐渐熟悉的街头&lt;br /&gt;
十年之后&lt;br /&gt;
我们是朋友 还可以问候&lt;br /&gt;
只是那种温柔 再也找不到拥抱的理由&lt;br /&gt;
情人最后难免沦为朋友&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;再见了心爱的梦中女孩&lt;br /&gt;
我将要去远方寻找未来&lt;br /&gt;
假如我有一天荣归故里&lt;br /&gt;
再到你窗外诉说情怀&lt;br /&gt;
再见了心爱的梦中女孩&lt;br /&gt;
对着你的影子说声珍重&lt;br /&gt;
假如我永远不再回来&lt;br /&gt;
就让月亮守在你窗外&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;愿踏上人生旅途的各位一路平安；&lt;br /&gt;
愿世间每一份努力都不被辜负；&lt;br /&gt;
愿平凡的你我诸事遂愿；&lt;br /&gt;
愿看到这里的读者万事如意。&lt;/p&gt;

&lt;h2 id=&quot;梦醒了&quot;&gt;梦醒了&lt;/h2&gt;

&lt;p&gt;In transition。&lt;/p&gt;

&lt;p&gt;对于百年前的中国而言，我们所处的时代，实在是一个小时代。尽管世界各国暗流涌动风云变幻，但我们成人前的年月，中国的环境可谓闷声发大财，稳中向好。大时代所具备的特质，大时代会给人们留下的烙印，并未被我们这一代人所继承。&lt;/p&gt;

&lt;p&gt;然而，在我们面前的，是一个正在转变的世界。而我们的人生，恰巧也处在行将转变的岔路口。无数个个体的转变，终将促成整个世界的转动。No Snowflake in an avalanche ever feels responsible. 裹挟在时代的洪流中的水滴，殊不知自己也决定了洪流的走向。&lt;/p&gt;

&lt;p&gt;如何把握一个时代的脉搏，是逆潮流而上还是顺潮流前行，上至中美关系世界格局民族融合平等权益，下及柴米油盐结婚生子兢兢业业刻苦学习，无一不是未来生活中的重要议题。&lt;/p&gt;

&lt;p&gt;学生生涯谢幕了，而人生的大幕才徐徐展开。后台喘口气，新的演出马上就将开始。上一场的演员谢了幕，满鬓白发地坐在台下欣赏我们的演出。天下没有不散的筵席，当人生这出四幕戏排演至高潮之时，或许观众会慢慢地，再也不回头地踱步而去。没有人指导这出戏该如何继续演下去，现场再无观众对我们的演出进行评判。这出戏或许会演得毫无新意，或许光怪陆离。无从知晓。&lt;/p&gt;

&lt;p&gt;当命运降临于你，当时代的转折点阴差阳错地出现在你面前时，只希望你能凭借往日的经验应对自如，只希望你能优雅而从容地说出那句：&lt;/p&gt;

&lt;p&gt;“你好，世界”。&lt;/p&gt;
</description>
        <pubDate>Fri, 10 May 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/school/graduation-one-last-dance/</link>
        <guid isPermaLink="true">https://yo1995.github.io/school/graduation-one-last-dance/</guid>
        
        <category>life</category>
        
        <category>graduate</category>
        
        <category>friends</category>
        
        
        <category>School</category>
        
      </item>
    
      <item>
        <title>650 作业回顾</title>
        <description>&lt;p&gt;这学期650做了几个作业，让我再次体会行将毕业还需用C语言来实现许多成熟功能时的心累——多么痛的领悟！&lt;/p&gt;

&lt;p&gt;总体来说，这些作业的代码质量实在一般，都有虎头蛇尾之嫌。虽然最后分数不低，但仍自觉写得十分垃圾。&lt;br /&gt;
因此在此简单回顾一下这些作业中值得反思与改进的地方，为以后再写C提供一些参考。&lt;/p&gt;

&lt;h2 id=&quot;hw1--hw2---my_malloc&quot;&gt;HW1 &amp;amp; HW2 - my_malloc&lt;/h2&gt;

&lt;p&gt;上来头一个作业就来了个下马威。自己有大半年没有写过C程序，很多常用的变量类型和语法都有点忘了，有时也会和C++的写法搞混。加之作业的步骤写得很简略，不像551那样手把手教你如何编程，第一个星期着实有点难过。好在写了几个简单的测试程序，借助&lt;a href=&quot;http://cpp.sh/&quot;&gt;cpp.sh&lt;/a&gt;也找回些感觉。作业内容是设计一个程序来代替malloc/free的功能。按照我最开始的想法，直接把所有分配的块都记录下来接到一个链表上，在为每一个块设定一个是否可用的标志即可。但这个程序写出来以后用作业的测试用例一测，运行时间将近十分钟……等得花儿都谢了还以为自己写了死循环，做完饭发现跑出了结果。主要是因为全由一个链表管理时，每次分配都需要遍历链表长度数量级的节点，从而在不断malloc后消耗越来越长的时间。&lt;/p&gt;

&lt;h3 id=&quot;改进&quot;&gt;改进&lt;/h3&gt;

&lt;p&gt;改进的思路有两种，一种是只记录空闲块，即每次free后才将块计入链表，并在下次分配时从空闲链表移除该节点。另一种是保留两个链表，一个记录所有分配块，另一个记录空闲块。最后，为了省事，我还是采用了后者，毕竟完整链表的代码已经写好，想着偷懒便在那基础上改。这一改反而给自己造成了更多的麻烦……&lt;/p&gt;

&lt;p&gt;只记录空闲块有一个问题，即不知道一块内存是否由本程序分配。解决方案也很简单，可以在每块分配的内存的元数据中添加一些标识符，来确保是我们的malloc分配的内存。&lt;/p&gt;

&lt;p&gt;另一种思路曾经考虑过用二叉树来记录空闲块，这样在使用best fit策略查找特定大小的内存时时间复杂度较低。但由于自己基本功有些差，而且这种策略在合并相邻内存难以实现，因此没有继续深究。因为sbrk函数实际上是线性地在heap上申请空间分配给data segment区，比较适合采用一个线性的数据结构来对应其位置与顺序。&lt;/p&gt;

&lt;h3 id=&quot;合并策略&quot;&gt;合并策略&lt;/h3&gt;

&lt;p&gt;当相邻的空闲块出现在空闲链表中时，我的策略是先从当前块向前遍历到第一个连续空闲块后再向后合并所有连续空闲块。这样的设计实际上效率与直接向后合并没有太大差距，但实现起来更容易出错——毕竟，判断指针是否合法、什么条件对应如何合并需要考虑清楚。也就是这里的过于追求合并的高效，造成第二次作业改进为多线程时的无法bug free……&lt;/p&gt;

&lt;h3 id=&quot;第二次作业&quot;&gt;第二次作业&lt;/h3&gt;

&lt;p&gt;第二次作业是在第一次作业基础上将malloc分别有锁和无锁地改写为多线程程序。有锁简单，只要把之前程序中所有涉及sbrk申请内存，以及改写两个链表的部分都加上锁就可以了。这种改法在测试中完全相当于重复执行单线程程序，时间也几乎就是单线程固定的倍数，没有什么特别的。&lt;/p&gt;

&lt;p&gt;无锁的方案利用了Thread Local Storage (TLS)变量的特性，即每个线程分别分配不同的内存，实现同名变量在线程间内存相互隔离。这时我又犯难了：究竟是推倒重来，完全用单一空闲链表的思路实现呢，还是在当前双链表的基础上改进呢？最后还是懒惰占了上风，也让我付出了不小代价：直到due前两小时还在debug，最终也没有bug free。&lt;/p&gt;

&lt;p&gt;多线程的主要问题就在于如何合并相邻空闲块。由于sbrk分配的内存地址仍旧是线性增长的，但存到空闲块链表的相邻块地址则不一定是连续的，这时候就需要很多与边界有关的判断。交作业时候心一狠直接把合并函数注释掉了，基本不影响时间，只是增加了fragmentation的指标，没扣几分，还算幸运……&lt;/p&gt;

&lt;h2 id=&quot;hw3---socket_game&quot;&gt;HW3 - socket_game&lt;/h2&gt;

&lt;p&gt;这次作业是第一次编写Linux socket相关的程序。在这之前，进程间通信、TCP协议的程序我是从来没有接触过，这次作业也是写得最辛苦的一次。从零开始读文档，借助老师给的例程理解SOCKET/BIND/LISTEN/ACCEPT/CONNECT/CLOSE/SEND/RECV分别是做什么的，哪个之后应该接哪个。在建立各个player之间以及与master的双向通信的图状结构时还比较顺利，等发起数据时候就乱套了。先是没有理解好select函数的作用，直到快due才明白它自己就可以同时监测多个socket/file descriptor。然后是没搞清楚socket关闭后会发生什么，于是对最后清理时出现的种种bug百思不得其解。&lt;/p&gt;

&lt;p&gt;依旧在提交时也没能bug free，只在某些情况下能够输出正确的结果，另一些情况下对于结束条件的判断存在bug。尤其是对于这种多进程程序，没有类似于单进程valgrind调试时方便简洁的工具，只能使用最野蛮最原始的打印与断言调试法，一行一行测试哪里搞错了。相信我，这个过程比我描述得更痛苦，连续花了好几个晚上在3409 debug，每天都信心满满认为明天就能交作业，结果第二天又备受打击地继续陷入debug的困境。这也是我第一次因为程序功能没有实现完全，而非segfault或内存泄露而没有把程序写完善。&lt;/p&gt;

&lt;p&gt;最后一点感想就是C程序员真的很辛苦。不像现代语言有许多方便的特性、易懂的预分析结果、详尽的文档与注释，C程序很多时候都得赤膊上阵自己干。哪怕是C++ 11、甚至Windows下的VC++相比之下都没有那么打击人。我曾以为VC++已经是最难读懂文档实现功能的库与语言了，直到我真正写了一些稍微复杂的C程序。&lt;/p&gt;

&lt;h2 id=&quot;hw4---libpqxx&quot;&gt;HW4 - libpqxx&lt;/h2&gt;

&lt;p&gt;经历了第三次作业的摧残，第四次作业简直是白送。完全没有任何难度，当一次调库侠，按照libpqxx的文档抄抄改改就完成了C++的简单ORM方法的封装。在这次作业中我才知道，SQL injection是多么容易避免的错误，现代的数据库这些细节已经非常完善了。同时，由于作业要求并不要求关于删改部分的操作，也没有多线程等等复杂要求，因此真的让人觉得没学到什么。&lt;/p&gt;

&lt;p&gt;为了弥补前两次作业失掉的分数，我选择做了这次的附加题。附加题要求用现有ORM工具实现查表，按照Django的文档走一遍就好了。这也是我第一次真正写一个完整的基于Django的Model-View-Template/Form的后台服务，也第一次发现原来后台起个服务器能这么简单快捷！在这之后，学期中好几个项目我都用了Django作为后台。&lt;/p&gt;

&lt;h2 id=&quot;hw5---rootkit&quot;&gt;HW5 - rootkit&lt;/h2&gt;

&lt;p&gt;rootkit这次作业代码量比较少，逻辑也很清楚，但我仍旧花了不少时间在debug和改进代码上。总体来说，这次作业的代码质量比之前稍有进步，由于需求很清晰，最初搭建的框架简洁明了，也基本做到了注释简明易读。只是有几个问题耽误了大量的时间。&lt;/p&gt;

&lt;p&gt;通过&lt;code class=&quot;highlighter-rouge&quot;&gt;cat /proc/kallsyms | grep memcpy&lt;/code&gt; 来查询内核中是否有memcpy这个符号。&lt;/p&gt;

&lt;p&gt;具体逻辑跟随着作业简介，通过&lt;code class=&quot;highlighter-rouge&quot;&gt;strace&lt;/code&gt;来查看不同命令调用的syscall。&lt;/p&gt;

&lt;h3 id=&quot;内核debug&quot;&gt;内核debug&lt;/h3&gt;

&lt;p&gt;由于没有趁手的工具，debug时没法像gdb那样对全局一目了然，也没有图形化IDE的debugger那样直截了当地显示所有变量的便捷，因此我又使用了最低效的办法：注释与打印。&lt;/p&gt;

&lt;p&gt;最开始时由于每次insmod注入后，都会发生kernel panic，令我十分烦恼。因此我采用了“增量”测试的方法——先把所有功能代码注释掉，再一个个取消注释，测试具体函数。当我全部注释掉后，才发现原来是对原函数取址时硬编码的地址写反了，造成管理分页权限的函数没有执行成功，才导致了每次都会崩溃。改好了后终于把模块跑了起来。&lt;/p&gt;

&lt;p&gt;而后，当我插入getdents函数后又造成内核被Killed，分析后发现应该是死循环造成的，进而看到自己又犯了while循环忘记步进的低级错误。自从决定不在自己的C代码中写for后，无数次被自己坑惨，实乃自作孽不可活。🤦‍&lt;/p&gt;

&lt;h3 id=&quot;copy_to_user&quot;&gt;copy_to_user&lt;/h3&gt;

&lt;p&gt;再往后，程序基本正确，但在open函数中始终无法正确执行copy_to_user这个函数。man page中并没有该函数的文档，谷歌后只在kernel.org上查到了__copy_to_user这个函数的文档。我想当然就以为二者应该是一样的，况且在GitHub上搜该函数对应的代码和文档中的用法基本一致，因此从未想过“官方”文档竟然也会出错！为了解决这个bug，花了整整两个晚上将近6小时时间，尝试了网上提到的所有copy_to_user的用法——包括改为__put_user，拷贝指针地址而非变量本身，改变缓冲区大小等等。可无论怎么改，返回值始终不是0，也就意味着函数不成功。由于我设置了类似断言的错误处理，每次都会把内核搞乱，因此每测试一次就要重启一次虚拟机，搞得我精疲力竭后，还是同学指出或许是返回状态值可能有误，才将我解脱出这篇苦海。&lt;/p&gt;

&lt;p&gt;最后发现，原来官方文档也不能全信！一定要自己设计些小的测试用例来熟悉这些非原生的、文档不详的函数，才能避免在上面大费周章。&lt;/p&gt;

&lt;h3 id=&quot;清理不成功&quot;&gt;清理不成功&lt;/h3&gt;

&lt;p&gt;最后就是从内核移除rootkit注入模块后清理不成功。像极了个捣蛋鬼小朋友，搞乱了之后不知如何恢复原貌。我总觉得把改过的地方都恢复，按理说就能够无痛移除，但实际上会有未知的bug，在我rmmod后发生在内核中，从而扰乱与文件相关的一些服务，包括除了当前活动的session外其他ssh session断开的问题。暂时还没有想出应该如何完美清理rootkit。&lt;/p&gt;

&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;

&lt;p&gt;作为一门研究生课程，其难度我觉得只能达到本科生大二到大三之间的水平。尽管如此，我还是学到了不少知识，尤其是有关操作系统以及虚拟内存、多线程/多进程相关的之前自己非常薄弱的知识，还算收获不少。也让我有些遗憾：要是当初学了计算机相关的专业就好啦，这些知识相比起大二时令人痛苦的光学、数学物理方法，乃至之后的热统，都是既简单又富有逻辑，可操作性也很强。虽然我并不后悔自己学过些物理，窥见过美好的人类知识的高峰，但也有些遗憾——要是更早认清自己能力不足以挑战那些极其复杂的物理问题，而转而学习这些由工程师建立起的知识体系与框架，或许能掌握更多方法论的知识。孰是孰非，只能交由时间判断了！&lt;/p&gt;
</description>
        <pubDate>Tue, 16 Apr 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/coding/ece650-homework-review/</link>
        <guid isPermaLink="true">https://yo1995.github.io/coding/ece650-homework-review/</guid>
        
        <category>network</category>
        
        <category>project</category>
        
        <category>coding</category>
        
        <category>cpp</category>
        
        
        <category>Coding</category>
        
      </item>
    
      <item>
        <title>LG UltraFine brightness adjustment tool for Windows</title>
        <description>&lt;p&gt;Please refer to &lt;a href=&quot;https://github.com/yo1995/Daily_GUI_Tools/tree/master/Tool_LG-Ultrafine-brightness&quot;&gt;This link&lt;/a&gt; for English description and download.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;调节-lg-ultrafine-5k-显示器-亮度-的-windows-小工具&quot;&gt;调节 LG UltraFine 5K 显示器 亮度 的 Windows 小工具&lt;/h2&gt;

&lt;p&gt;在学校有一点好，就是可以蹭Ric大佬的高端显示器。1300刀的显示器！跟当年爹的“特丽珑”一个价位啊……&lt;br /&gt;
LG UltraFine 5K系列，专门为MacBook Pro打造，加上一台仍旧不太过时的Mac Pro，简直是多媒体生产力爆表的利器。让我这个没怎么用过高端电脑的无产阶级啧啧称奇——第一次用上了Pr和Ae双开不卡的电脑！&lt;/p&gt;

&lt;p&gt;只因为在人群中多看了它一眼，这块显示屏便成了我赖在学校不走的最好原因。本以为笔记本的这块100%AdobeRGB 4K屏就已经相当出众，无论是色彩还是细腻程度，都已经让我非常满意。但看过了5K屏以后，感觉无论21寸iMac，还是常见的Windows笔记本FHD雾面屏，还是家里的Dell P2417H写码屏，都仅可算得上差强人意。真的，5K屏真的太出众了！我的许多拍摄的桌面背景图分辨率只有3648@10MP，在这块屏上凑近了看，甚至能看出些微的模糊和Bayer pattern来。等啥时候有钱了，拍照片分辨率争取也升到24MP……从信号采集到重建到可视化到存储，一条龙升级起来估计得花不少钱……&lt;/p&gt;

&lt;p&gt;除了编程和剪视频，平常还常用这块屏接XPS做作业用。&lt;br /&gt;
先说优点：这块屏自带一个全功能USB-C口，支持显示、充电和数据，以及三个数据口。如此一来，无论是新款MacBook Pro，还是XPS，都可以实现仅用一条显示器电源线和一条双端USB-C公线即插即用。这样一来，桌面真的非常简洁，让人强迫症得到极大的满足。同时，也免去了天天背着笔记本适配器跑的麻烦。&lt;br /&gt;
再说缺点：对于最新版Mac而言，几乎没有缺点。唯一的不足在于用时间长了有点烧屏的倾向，最好时常切换下桌面防止留下损伤。这个问题看网上(burn-in)似乎也有类似的。其次便是Windows适配性了。这块屏原本是专门为Mac定制的，在&lt;a href=&quot;https://www.apple.com/shop/product/HKN62LL/A/lg-ultrafine-5k-display&quot;&gt;苹果官网&lt;/a&gt;上出售，没有为Windows定制的驱动。同时，这又是一块全软驱，无实体按键的显示器。所有调节功能均通过软件实现。遇上Windows通用驱动，许多功能便没法使用，比如——调节亮度。&lt;/p&gt;

&lt;p&gt;上网一搜有两种解决方案：&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;用一个叫做&lt;a href=&quot;https://www.nelsonpires.com/software/dimmer/&quot;&gt;Dimmer&lt;/a&gt;的小工具，添加一个全屏黑块遮罩层，通过调节黑块透明度实现亮度调节。一听就是凑合事儿的玩意，pass&lt;/li&gt;
  &lt;li&gt;自制简易程序正确地调用亮度调节函数。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;这个小工具就是上面链接中的工具啦。&lt;/p&gt;

&lt;h2 id=&quot;其他&quot;&gt;其他&lt;/h2&gt;

&lt;p&gt;其实一直很疑惑显示器实体键的逻辑。像笔记本屏幕很早（上世纪末）就是完全软件调节的了，为什么台式机屏幕仍旧要做成带有实体键的设计呢？一种答案或许是为了连接其他不支持软件调节的设备，如老式游戏机、嵌入式开发板等等。但事实上，较为高端的桌面显示器出现在那些场景的可能少之又少，就像现代显示器没必要为了兼容性保留VGA接口一样。&lt;/p&gt;

&lt;p&gt;另一个答案或许就是今天这种情况了。显示器生产厂家擅长硬件，不专精软件。全软件调节意味着需要维护一个驱动团队来适配市面上所有常用系统。这样显然不利于成本控制。苹果的解决方案是保持封闭与自洽，而Windows在这方面要想更进一步，还有很漫长的路要走……&lt;/p&gt;

&lt;p&gt;又想起了前几天官方推送升级后蓝屏的无奈与气愤……&lt;/p&gt;

&lt;p&gt;还有Windows10发售至今仍旧没有良好解决的系统分辨率和缩放适配问题……&lt;/p&gt;

</description>
        <pubDate>Sun, 07 Apr 2019 00:00:00 -0400</pubDate>
        <link>https://yo1995.github.io/coding/lg-ultrafine-brightness/</link>
        <guid isPermaLink="true">https://yo1995.github.io/coding/lg-ultrafine-brightness/</guid>
        
        <category>tools</category>
        
        <category>plugin</category>
        
        <category>coding</category>
        
        <category>cpp</category>
        
        
        <category>Coding</category>
        
      </item>
    
      <item>
        <title>Do what I can't</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://bbs.byr.cn/#!article/Photo/266508&quot;&gt;vlog&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;最近又回到了一种懒洋洋难以坚守计划的状态当中，很烦躁，但又不知该如何摆脱。或许下周再去和Debbie聊聊。&lt;/p&gt;

&lt;p&gt;前几天论坛上有人聊到vlog的话题，在跟帖中看到了Casey Neistat的名字。YouTube一通看下来，感慨这才是心中New Yorker的样子！&lt;/p&gt;

&lt;p&gt;在我开始大学之旅之前，曾有一段时间非常纠结拍摄的手法和设备，如何才能获得更有“质感”的画面、如何才能以画面语言烘托片子的氛围。但后来释然了——拍片子剪片子的核心与灵魂还是内容。讲好一个故事，比无端堆砌特效转场剪辑技巧来得实在得多。&lt;/p&gt;

&lt;p&gt;Storytelling!&lt;/p&gt;

&lt;p&gt;从小到大，我是一个讲故事很好的人吗？看着新概念厚厚的十多卷书，自觉比不上天赋异禀的笔者。但我讲述的故事也并非荒诞不经无聊透顶，有时能看出些璞玉浑金大巧不工的灵光一闪来。但我害怕，总怕把辛辛苦苦攒出来的素材讲撇了，索性一拖再拖根本没有勇气去尝试。而我又是个很吃trial error经验的人，自己不试一下永远没法领悟一些道理。这便是个怪圈，越是不敢尝试便越抵触尝试。倘若没有外界的敲打提醒，或许就一发不可收拾地颓下去了。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;正如Casey视频中拍iPhone 5S排队时的一个场景所说的，纽约是冒险者的舞台，是疯子的集散地。在纽约短短的一个周末，便能体会到这种push harder直到极限的畅快淋漓的纽约气质。独在异乡的孤独旅人，面对曼哈顿核心那些仿佛要吞噬世界的摩天高楼，要么被吓趴下，要么会在心底胸间燃起“彼可取而代也”的勇气。同为摩登都市，我对纽约的印象比香港要更好，尽管二者都是不可一世的财富中心。香港颇有些“中国特色”在里面——克制、螺蛳壳里做道场、事不关己、退一步海阔天空……而纽约则更生动。尽管作为世界文明的十字路口已经发达了百余年，你还是能在川流不息的人群中感到不止息的活力。在纽约印象最深的不是法拉盛地铁一出来“哇回国了”的惊叹，也不是帝国大厦观景台世界各种语言低声细语窃窃私语对鳞次栉比的曼哈顿的议论与感慨，而是从中央车站徒步走到联合国大楼路上，亲眼所见亲身所感的城市的梯度。纽约中央车站，真正称得上是文化融合的“十字路口”。整个大厅也是十字形的，既有乔丹的牛排店，也有璀璨的苹果标。而走出车站，一路向西，便从第五大道的繁华逐渐变成了小意大利的萧索。肉眼可见的街道上突然多了许多不明所以的黑灰色污迹，树坑里也飘来意犹未尽的烧草异香。两旁的店铺不再是整整齐齐的精品店、时装橱窗，而是乱七八糟的招租、小粉灯霓虹灯悬挂的异域风情。马路上黑人大兄弟骑着车乱晃，街边青铜色大铁门里走出来穿着荧光黄和亮粉色包臀裙和小皮裤、踩着恨天高、抽着香烟的大姐姐。看得我这个乡下佬一阵头晕目眩。而到了联合国大楼面前，则又变成一派庄严肃穆的景象，那楼修得好似阿兹卡班一样毫无修饰而严丝合缝。嗨呀，纽约真是不得了！&lt;/p&gt;

&lt;p&gt;有时我会反思，我究竟向往哪种生活。每每和陌生人聊天，譬如lyft司机、譬如学校里住在本地的教职工、譬如在机场工作却从未去过西海岸的黑人老妹儿，我总会说自己喜欢宁静安逸的乡下生活，就像德罕和杜克森林一般。诚然，在北京的两打岁月，一半是内城，一半是郊野。在城里，我受够了阴暗潮湿破旧的五十年代苏式社区。在乡下，我又羡慕起城里片腿儿就能吃碗柴氏的方便与享受。来到杜克前，我和Amy讲自己或许能适应这里的生活；现在看来，我超喜欢这里的！运动氛围浓厚，生活节奏缓慢，简直是养老度假胜地！但是等等……我还是个“孩子”啊！青年人怎能每天沉溺于乡下的慢节奏生活呢？&lt;/p&gt;

&lt;p&gt;正如深深烙印在文化当中的特质一样，我非常克制，倾向于深深埋藏那些非分之想。但有了合适的药引、恰当的火石，又会像火山喷发一般溅得到处都是。自己从不缺少想法，但永远缺少动力。这便是如我一般的众人与Casey那样的奇人之间最关键的差距。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;搶救性拍攝&lt;/p&gt;

&lt;p&gt;在踏上大学之旅之前，想了很多，却毫无头绪。抢救性拍摄，这是我对那次旅行的理解与定义。&lt;/p&gt;

&lt;p&gt;The biggest asset of life, is time. 曾多次许下与时光有关的期许与愿望，但深知连上天也敌不过岁月的轮回。有些故事现在不讲，上至千古下及万代，永远也没有机会再讲。倘若不在这一瞬间拍下快照，那时光的列车便会隆隆向前一去不返。我并不着急剪辑这些故事，因为我知道拍下了便已成功了大半，这些话语、这些年少的理想与希望，这些或许毫无头绪的故事在长久的未来以后将会酿成醇厚的花雕，再由我们与来自波兰的旅人开怀畅饮。&lt;/p&gt;

&lt;p&gt;但看了Casey的故事，又觉得自己有义务有必要尽快把这一时一刻的想法与理解也赶紧记录下来。人在进入社会后会变，就算是两耳不闻窗外事、心无旁骛的牛人也无法抵御当今世界信息洪流的洗礼。快些吧，趁一切还没变太多，讲述这段故事。&lt;/p&gt;

&lt;p&gt;目前的想法是继续完善预告片，6加入旁白7加入对话8融合剪辑和对话以及音乐，然后就差不多可以正式开搞了。
还想写一些人物速写，就像之前姚睿的那样，作为故事的题词板与资料库。慢慢写，慢慢改，故事大致就能讲出来了。&lt;/p&gt;

&lt;p&gt;不要把故事讲得太复杂！&lt;/p&gt;

&lt;p&gt;Don’t make judgement at night!&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Challenge&lt;/p&gt;

&lt;p&gt;俄罗斯方块，我接受了挑战，目前进展良好。&lt;/p&gt;

&lt;p&gt;编程，我也接受了挑战，正在焦急地等待评分怪对我的评价。&lt;/p&gt;

&lt;p&gt;待人接物，似乎有些进展，缩短了与想象中的差距。&lt;/p&gt;

&lt;p&gt;金钱，遥遥无期，但慢慢增长总比慢慢下降来得更乐观。&lt;/p&gt;

&lt;p&gt;知识……唉，今天肖老师戳了我的痛处。易正磊学长和田文静学姐双双博士博后；418、419寝室15人有10人行将踏上博士的冒险。而我，只好在岸边谷底为他们加油。多希望有一天我能一刀999级搞定全套满级装备跟着王石一起攀上珠峰！嗨呀，又开始纠结器材而不注重内容了！&lt;/p&gt;

&lt;p&gt;女孩……人生三大错觉？但我真的觉得收到了积极的信号。&lt;/p&gt;

&lt;p&gt;当然，大四男子铁三！&lt;/p&gt;
</description>
        <pubDate>Thu, 21 Feb 2019 00:00:00 -0500</pubDate>
        <link>https://yo1995.github.io/video/do-what-i-cant/</link>
        <guid isPermaLink="true">https://yo1995.github.io/video/do-what-i-cant/</guid>
        
        <category>youtube</category>
        
        <category>video</category>
        
        <category>lifestyle</category>
        
        <category>projectuniv</category>
        
        
        <category>Video</category>
        
      </item>
    
      <item>
        <title>《流浪地球》电影简评</title>
        <description>&lt;p&gt;直截了当，我为这部电影打出7.9分，加上国产情怀在豆瓣给了五颗星。我认为其综合水准接近火星救援，略低于星际穿越，在国内科幻电影领域堪称零的突破、一枝独秀、睥睨群雄。比上不足，比下绰绰有余。&lt;/p&gt;

&lt;p&gt;先说一些缺点。电影存在几方面不足，如科学设定、剧本改编、导演与表演、拍摄手法等等。科学方面，仅就我自己观感而言，刨除大背景将地球推离轨道寻找新的恒星系不谈，单谈一些细节，存在以下的一些缺陷：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;星球轨道预测失误造成灾难。这一点在原著中似乎并不是这样，但电影为了制造矛盾，特意将剧情主要集中在一个极短的时间段内。作为一个千年的计划，如果还没出太阳系就预测失败，从概率上来讲九死一生。这个问题主要来自于剧本改编。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;时间线比例不合理。按照电影中字幕的写法，整个影片的时间轴大概只有不到一个月的时间。天文单位的量级完全不能与人类定义的太阳年、公转自转周期相比拟，因而看电影时会觉得剧情太过于拥挤，节奏太快没有星际旅行时那种荒凉与寂寥的感觉。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;星舰人工智能违反机器人三定律，且星舰构件不阻燃。人类若能够拥有造出行星发动机的技术，却不能造出一个功能完善的微缩生态系统的飞船，是有些奇怪的。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;对于地球自身大气层、地下城和地表地理水文情况的模糊化处理。星际旅行时一些物理规律不可避免地会改变，但电影似乎并没有交代，不知原著中是否有更详细的设定。电影中全程用漫天飞雪刻画地表气候，有节省成本之嫌，也给观众留下了一点点遗憾。不过，从电影末段星舰中眼泪的特写看得出来，剧组对于更深入的物理规律方面的特效应该是有心无力，只能一分钱掰两半、尽可能在有限成本内展现出更好的视觉效果。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;表演方面，年轻演员的水准只能说是及格。毕竟在吴京投资前电影差点烂尾，很多表演估计也没有认真雕琢。许多观众吐槽不解的女主角朵朵的各种出戏表演，是影片为数不多的硬伤之一。这或许也是国产硬科幻电影探索过程中必须走过的弯路。没必要非得在宏大的世界观中加入日常的喜剧与温情的元素，甚至还有迎合春节档期的“年味儿”。科幻就是科幻，煽情可以但更宜点到为止，不然真的步了“用爱穿越时空”的后尘。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;导演与拍摄方面，我的评价是全片过于拥挤，留白不足。看完后在网上看评论有人说原片还有约半小时的额外内容，交代背景、串联剧情，但因为春节档期宝贵增加排片率被剪辑掉了。诚然，电影是面向市场的，需要作出一些妥协，但确实目前的作品实在让人意犹未尽。很多剧情都显得急吼吼乱糟糟，尤其是大地震后开始救援、步行去杭州、开车去赤道等情节设计，既折损了时间线的合理性，又显得剧情发展太过着急。而最后点燃木星的一段，三个小队的剧情又有些拖沓、许多人物的存在要么过于刻意、要么缺乏个性。星际旅行，不该是“欢欢喜喜过大年”这样锣鼓喧天的大鸣大放式的节奏，而更多时候应该是克制、谨慎、严格规制与限制配给、整齐划一而服从命令的精确地一环扣一环。人在星际旅行中倘若不能尽到人类的义务，那便会成了电脑开着诺亚方舟带着一群动物飞。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;作为第一部探索式的科幻片，当然，《流浪地球》仍有诸多不足，但我还是要吹爆！真的，当我走进电影院时，我并未抱太高的期望——毕竟，国内观众已经被各种垃圾影片荼毒甚久，合理地欣赏、评价影片都成了一种奢求！看完后，我知道中国电影还是有希望变得更好的。&lt;/p&gt;

&lt;p&gt;整部影片中用了很多致敬前辈科幻电影的桥段与梗，也借鉴了许多成功的商业科幻电影的表现手法。其中我印象最深刻的几个镜头，第一便是对于行星外景静帧的使用。这是一种很讨巧、节省成本而效果拔群的手法，非常能够表现宇宙的荒芜与静谧、令人恐惧的未知的真空、以及天体的宏大与人类的渺小。那些精美的画面能让人更好地理解星际旅行作为人类想象力的产物，实乃科学的严谨与人类共情的浪漫的交融。第二是对于许多大型机械的刻画，包括星舰的细节刻画，我认为特效预算还是花到位了的。很过瘾，没有抠图飞船和反重力特效，一切视觉效果仍在物理规律可以理解的范畴之内。还有就是中国城市建模，可以说并没有偷工减料，北京上海的标志性建筑描绘的还算精细。总之，在特效和画面方面，这部电影的呈现堪称优秀。&lt;/p&gt;

&lt;p&gt;爱国情怀和世界观，是电影另一个不可忽视的优点。这部电影并未像“抖音开外放”式地通过大嗓门弘扬中华文化或爱国精神，而是用一种较为克制、万众一心齐心协力的方式让观众逐渐获得一种置身其中的参与感与使命感。这样的手法实在得归功于作者刘慈欣——原著的主线世界观与价值观，比漫画英雄或是主角光环高到不知道哪里去了！正像网上所评论的那样——“人类命运共同体”，只有中华文明、具有足够悠久历史的文明才能孕育出这样的家园情怀，才能在危难面前众志成城，牺牲个体而顾全大局。求人不如求己，有底蕴的文明才能参悟出这样的道理。&lt;/p&gt;

&lt;p&gt;更多的溢美之词不再多说，毕竟影片还未能达到“优秀”的水准。但顾及上述缘由，我还是在豆瓣给这部电影打出五星好评。希望这部电影能够在未来的发展中扮演基准、参照物的作用，让更多的优秀国产电影向他看齐，让中国科幻、电影事业航向星辰大海。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/201902/wandering_earth.png&quot; alt=&quot;seats&quot; /&gt;&lt;/p&gt;

&lt;p&gt;PS 这是来美国后看过的第一场电影，AMC IMAX。也是我第一次看3D IMAX，效果还不错，只是眼镜套眼镜有点累……&lt;/p&gt;

&lt;p&gt;一般只有非看不可的电影，或是免费发票的我才会去电影院专门看。记忆里上次去电影院应该就是《星际穿越》的时候了。&lt;/p&gt;
</description>
        <pubDate>Wed, 06 Feb 2019 00:00:00 -0500</pubDate>
        <link>https://yo1995.github.io/movie/wandering-earth/</link>
        <guid isPermaLink="true">https://yo1995.github.io/movie/wandering-earth/</guid>
        
        <category>movie</category>
        
        <category>review</category>
        
        <category>science</category>
        
        <category>universe</category>
        
        <category>future</category>
        
        
        <category>Movie</category>
        
      </item>
    
  </channel>
</rss>
